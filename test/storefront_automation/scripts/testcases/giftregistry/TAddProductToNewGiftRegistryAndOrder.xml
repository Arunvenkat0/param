<?xml version="1.0" encoding="UTF-8" ?>
<testcase version="3" xmlns="http://xlt.xceptance.com/xlt-script/2">
  <description>Places an order from a new gift registry and checks if the purchase is visible on the gift registry page. These are the steps in detail:
- register a new user
- create a new giftregistry
- add two products
- log out
- search for the gift registry
- order the first product, guest checkout
- search for the gift registry again
- validate if the &quot;quantity purchased&quot; of the first product has changed</description>
  <module name="modules.staticelements.Homepage"/>
  <command name="store" target="${RANDOM.String(8)}" value="UserFirstName"/>
  <module name="modules.usermanagement.RegisterNewUser">
    <parameter name="FirstName" value="${UserFirstName}"/>
    <parameter name="LastName" value="${UserLastName}"/>
  </module>
  <action name="GoToGiftRegistries"/>
  <module name="modules.giftregistry.OpenGiftRegistryPage">
    <parameter name="LinkText" value="Gift Registries"/>
    <parameter name="Headline" value="Find Someone's Gift Registry:"/>
  </module>
  <action name="ClickNewRegistry"/>
  <command name="clickAndWait" target="name=dwfrm_giftregistry_create"/>
  <command name="assertText" target="css=.breadcrumb-last" value="Gift Registry"/>
  <command name="assertText" target="xpath=id('dwfrm_giftregistry_event')//legend[1]" value="regexpi:Event Information.*"/>
  <action name="EnterEventAndParticipantData"/>
  <module name="modules.giftregistry.GiftRegistryEnterEventAndParticipantData"/>
  <action name="EnterShippingData"/>
  <command name="clickAndWait" target="name=dwfrm_giftregistry_event_confirm"/>
  <module name="modules.giftregistry.GiftRegistryEnterShippingData"/>
  <action name="ValidateGiftRegistryData"/>
  <command name="clickAndWait" target="name=dwfrm_giftregistry_eventaddress_confirm value=Continue"/>
  <command name="assertTextPresent" value="glob:*${UserFirstName} ${UserLastName}*,* ${SecondParticipantFirstName} ${SecondParticipantLastName}*${EventType}*${EventDate}"/>
  <command name="assertTextPresent">
    <value>glob:*${ShippingAddressFirstName} ${ShippingAddressLastName}*${ShippingAddressStreet} ${ShippingAddressCity}*${ShippingAddressZipCode}</value>
  </command>
  <action name="SubmitGiftRegistry"/>
  <command name="clickAndWait" target="name=dwfrm_giftregistry_event_confirm"/>
  <module name="modules.giftregistry.ValidateGiftRegistryPageStructureMyAccount">
    <parameter name="EventName" value="${EventName}"/>
    <parameter name="EventDate" value="${EventDate}"/>
  </module>
  <command name="assertText" target="css=#dwfrm_giftregistry_items fieldset:first-child p" value="You have no items in your gift registry."/>
  <action name="ClickAddItems"/>
  <command name="clickAndWait" target="link=Add Items"/>
  <action name="SearchAndAddProduct"/>
  <module name="modules.search.SearchProductByIDOrName">
    <parameter name="SearchText" value="${ProductID}"/>
  </module>
  <module name="modules.catalog.ValidateProductDetailsPageStructure"/>
  <module name="modules.catalog.ValidateProductDataOnDetailsPage">
    <parameter name="Name" value="${ProductName}"/>
    <parameter name="Price" value="${ProductPrice}"/>
  </module>
  <action name="AddProductToGiftRegistry"/>
  <command name="clickAndWait" target="link=Add to Gift Registry"/>
  <module name="modules.giftregistry.ValidateGiftRegistryPageStructureMyAccount">
    <parameter name="EventName" value="${EventName}"/>
    <parameter name="EventDate" value="${EventDate}"/>
  </module>
  <command name="assertXpathCount" target="id('dwfrm_giftregistry_items')//table[@class='item-list']/tbody/tr" value="2">
    <comment>Number of products plus 1 header row</comment>
  </command>
  <action name="SearchAndAddSecondProduct"/>
  <module name="modules.search.SearchProductByIDOrName">
    <parameter name="SearchText" value="${SecondProductID}"/>
  </module>
  <module name="modules.catalog.ValidateProductDetailsPageStructure"/>
  <module name="modules.catalog.ValidateProductDataOnDetailsPage">
    <parameter name="Name" value="${SecondProductName}"/>
    <parameter name="Price" value="${SecondProductPrice}"/>
  </module>
  <action name="AddSecondProductToGiftRegistry"/>
  <command name="clickAndWait" target="link=Add to Gift Registry"/>
  <module name="modules.giftregistry.ValidateGiftRegistryPageStructureMyAccount">
    <parameter name="EventName" value="${EventName}"/>
    <parameter name="EventDate" value="${EventDate}"/>
  </module>
  <command name="assertXpathCount" target="id('dwfrm_giftregistry_items')//table[@class='item-list']/tbody/tr" value="3">
    <comment>Number of products plus 1 header row</comment>
  </command>
  <action name="MakeItPublic"/>
  <command name="clickAndWait" target="name=dwfrm_giftregistry_setPublic"/>
  <command name="assertElementPresent" target="name=dwfrm_giftregistry_setPrivate value=Make This Registry Private"/>
  <command name="assertElementPresent" target="css=a.send-to-friend"/>
  <action name="GoToWelcomePage"/>
  <command name="waitForElementPresent" target="css=.user-account"/>
  <command name="clickAndWait" target="css=.user-account"/>
  <action name="Logout"/>
  <module name="modules.usermanagement.LogOutFromWelcomePage"/>
  <action name="GoToGiftRegistry"/>
  <module name="modules.giftregistry.OpenGiftRegistryPage">
    <parameter name="LinkText" value="Gift Registry"/>
    <parameter name="Headline" value="Gift Registry Login"/>
  </module>
  <action name="SearchForGiftRegistryAndValidateResult"/>
  <module name="modules.giftregistry.SearchForGiftRegistryAndValidateResult"/>
  <action name="ViewDetails"/>
  <command name="clickAndWait" target="css=.event-view a"/>
  <module name="modules.giftregistry.ValidateGiftRegistryDetails"/>
  <module name="modules.giftregistry.ValidateGiftRegistryProductRow">
    <parameter name="ProductCount" value="2"/>
    <parameter name="ProductRow" value="1"/>
    <parameter name="ProductName" value="${ProductName}"/>
    <parameter name="ProductID" value="${ProductID}"/>
    <parameter name="ProductPrice" value="${ProductPrice}"/>
    <parameter name="QuantityPurchased" value="0"/>
  </module>
  <module name="modules.giftregistry.ValidateGiftRegistryProductRow">
    <parameter name="ProductCount" value="2"/>
    <parameter name="ProductRow" value="2"/>
    <parameter name="ProductName" value="${SecondProductName}"/>
    <parameter name="ProductID" value="${SecondProductID}"/>
    <parameter name="ProductPrice" value="${SecondProductPrice}"/>
    <parameter name="QuantityPurchased" value="0"/>
  </module>
  <action name="AddFirstProductToCart"/>
  <command name="click" target="css=.item-list tr:nth-child(1) .add-to-cart"/>
  <action name="CheckMiniCart">
    <comment>Checks the correct behaviour of the mini cart window and the content of the added product</comment>
  </action>
  <module name="modules.minicart.CheckAutomaticAppearanceOfMiniCart"/>
  <module name="modules.minicart.CheckContentOfMiniCart">
    <parameter name="Name" value="${ProductName}"/>
    <parameter name="Quantity" value="1"/>
    <parameter name="PriceProduct" value="${ProductPrice}"/>
    <parameter name="Position" value="1"/>
  </module>
  <action name="GoToCart"/>
  <module name="modules.cart.GotoCart">
    <comment>Go to Cart View</comment>
  </module>
  <module name="modules.cart.ValidateCartContentForProduct">
    <comment>Validate carted product particulars</comment>
    <parameter name="Name" value="${ProductName}"/>
    <parameter name="SinglePrice" value="${ProductPrice}"/>
    <parameter name="TotalPriceProduct" value="${ProductPrice}"/>
    <parameter name="Quantity" value="1"/>
    <parameter name="TableRow" value="1"/>
  </module>
  <action name="ChooseGuestCheckout"/>
  <command name="clickAndWait" target="css=.cart-actions button[value='Checkout']"/>
  <module name="modules.checkout.ValidateCheckoutLoginPageStructure"/>
  <action name="GuestCheckoutShipping"/>
  <command name="clickAndWait" target="xpath=//*[starts-with(@name, 'dwfrm_login_unregistered')]">
    <comment>Click the guest checkout link.</comment>
  </command>
  <module name="modules.checkout.ValidateCheckoutProgressBar">
    <parameter name="StepNumber" value="1"/>
    <parameter name="StepText" value="Shipping"/>
  </module>
  <module name="modules.checkout.ValidateProductDataInSidebar">
    <comment>checks the first product in the summary</comment>
    <parameter name="Position" value="1"/>
    <parameter name="Name" value="${ProductName}"/>
    <parameter name="Quantity" value="1"/>
    <parameter name="Price" value="${ProductPrice}"/>
  </module>
  <module name="modules.adressmanagement.EnterAddressData">
    <parameter name="FirstName" value="${BillingAddressFirstName}"/>
    <parameter name="LastName" value="${BillingAddressLastName}"/>
    <parameter name="Address1" value="${BillingAddressStreet}"/>
    <parameter name="Address2" value=""/>
    <parameter name="Country" value="${BillingAddressCountry}"/>
    <parameter name="State" value="${BillingAddressState}"/>
    <parameter name="City" value="${BillingAddressCity}"/>
    <parameter name="ZipCode" value="${BillingAddressZipCode}"/>
    <parameter name="Phone" value="${BillingAddressPhone}"/>
  </module>
  <command name="check" target="id=dwfrm_singleshipping_shippingAddress_useAsBillingAddress">
    <comment>Use the same address for billing by ticking the checkbox.</comment>
  </command>
  <command name="check" target="xpath=//label[contains(., '${ShippingMethodName}')]/following-sibling::input">
    <comment>Select Shipping Method, select by text instead of position number. Only works with xpath.</comment>
  </command>
  <command name="waitForText" target="css=.order-totals-table .order-shipping.first td:first-child" value="glob:*${ShippingMethodName}*">
    <comment>Have to wait till the background sync finished.</comment>
  </command>
  <module name="modules.checkout.ValidateNumberFormatsCheckoutPage"/>
  <action name="GuestCheckoutBilling">
    <comment>check product information, required fields, enter Shipping details and variate shipping methods</comment>
  </action>
  <command name="clickAndWait" target="name=dwfrm_singleshipping_shippingAddress_save">
    <comment>Proceed to billing.</comment>
  </command>
  <module name="modules.checkout.ValidateCheckoutProgressBar">
    <parameter name="StepNumber" value="2"/>
    <parameter name="StepText" value="Billing"/>
  </module>
  <module name="modules.checkout.billing.ValidateEntryFieldsOnBillingPage">
    <parameter name="FirstName" value="${BillingAddressFirstName}"/>
    <parameter name="LastName" value="${BillingAddressLastName}"/>
    <parameter name="Address" value="${BillingAddressStreet}"/>
    <parameter name="Country" value="${BillingAddressCountry}"/>
    <parameter name="State" value="${BillingAddressState}"/>
    <parameter name="City" value="${BillingAddressCity}"/>
    <parameter name="ZipCode" value="${BillingAddressZipCode}"/>
  </module>
  <module name="modules.checkout.ValidateProductDataInSidebar">
    <comment>checks the first product in the summary</comment>
    <parameter name="Position" value="1"/>
    <parameter name="Name" value="${ProductName}"/>
    <parameter name="Quantity" value="1"/>
    <parameter name="Price" value="${ProductPrice}"/>
  </module>
  <module name="modules.checkout.shipping.ValidateShippingAddressInSidebar">
    <comment>Shipping Address Validation</comment>
    <parameter name="Name" value="${BillingAddressFirstName} ${BillingAddressLastName}"/>
    <parameter name="Address" value="${BillingAddressStreet}"/>
    <parameter name="City" value="${BillingAddressCity}"/>
    <parameter name="StateShort" value="${BillingAddressStateShort}"/>
    <parameter name="ZipCode" value="${BillingAddressZipCode}"/>
    <parameter name="Country" value="${BillingAddressCountry}"/>
  </module>
  <module name="modules.checkout.ValidateNumberFormatsCheckoutPage"/>
  <command name="type" target="id=dwfrm_billing_billingAddress_email_emailAddress" value="${RANDOM.String(8)}@varmail.de"/>
  <module name="modules.checkout.billing.SelectCreditCardAndEnterData">
    <parameter name="CardName" value="${CreditCardFirstName} ${CreditCardLastName}"/>
    <parameter name="Type" value="${CreditCardType}"/>
    <parameter name="Number" value="${CreditCardNumber}"/>
    <parameter name="ExpireMonth" value="${CreditCardExpiryMonthName}"/>
    <parameter name="ExpireYear" value="${CreditCardExpiryYear}"/>
    <parameter name="SecurityCode" value="${CreditCardSecurityCode}"/>
  </module>
  <action name="GuestCheckoutPlaceOrder">
    <comment>check product information, required fields, enter Shipping details and variate shipping methods</comment>
  </action>
  <command name="clickAndWait" target="css=.button-fancy-large">
    <comment>Click button to place order.</comment>
  </command>
  <module name="modules.checkout.ValidateCheckoutProgressBar">
    <parameter name="StepNumber" value="3"/>
    <parameter name="StepText" value="Place Order"/>
  </module>
  <module name="modules.checkout.ValidateProductDataOnPlaceOrderPage">
    <parameter name="Position" value="1"/>
    <parameter name="Name" value="${ProductName}"/>
    <parameter name="Quantity" value="1"/>
    <parameter name="PriceTotal" value="${ProductPrice}"/>
  </module>
  <module name="modules.checkout.shipping.ValidateShippingAddressInSidebar">
    <parameter name="Name" value="${BillingAddressFirstName} ${BillingAddressLastName}"/>
    <parameter name="Address" value="${BillingAddressStreet}"/>
    <parameter name="City" value="${BillingAddressCity}"/>
    <parameter name="StateShort" value="${BillingAddressStateShort}"/>
    <parameter name="ZipCode" value="${BillingAddressZipCode}"/>
    <parameter name="Country" value="${BillingAddressCountry}"/>
  </module>
  <module name="modules.checkout.billing.ValidateBillingAddressInSidebar">
    <parameter name="Name" value="${BillingAddressFirstName} ${BillingAddressLastName}"/>
    <parameter name="Address" value="${BillingAddressStreet}"/>
    <parameter name="City" value="${BillingAddressCity}"/>
    <parameter name="State_Short" value="${BillingAddressStateShort}"/>
    <parameter name="ZipCode" value="${BillingAddressZipCode}"/>
    <parameter name="Country" value="${BillingAddressCountry}"/>
  </module>
  <module name="modules.checkout.billing.ValidatePaymentCreditCardInSidebar">
    <parameter name="Name" value="${CreditCardFirstName} ${CreditCardLastName}"/>
    <parameter name="Type" value="${CreditCardTypeShort}"/>
    <parameter name="NumberLast4" value="${CreditCardNumberLast4Digits}"/>
    <parameter name="ExpireMonthShort" value="${CreditCardExpiryMonthNumber}"/>
    <parameter name="ExpireYear" value="${CreditCardExpiryYear}"/>
  </module>
  <module name="modules.checkout.ValidateNumberFormatsCheckoutPage"/>
  <action name="GuestSubmitOrder"/>
  <command name="clickAndWait" target="name=submit">
    <comment>Place the order by clicking the button.</comment>
  </command>
  <command name="assertText" target="css=#primary h1" value="Thank you for your order."/>
  <command name="assertText" target="css=.order-date span:first-child" value="Order Placed"/>
  <command name="assertText" target="css=#main .order-total td:first-child" value="glob:Order Total:"/>
  <module name="modules.checkout.summary.ValidateProductDataOnSummaryPage">
    <parameter name="Position" value="1"/>
    <parameter name="Name" value="${ProductName}"/>
    <parameter name="Quantity" value="1"/>
    <parameter name="Price" value="${ProductPrice}"/>
  </module>
  <module name="modules.checkout.summary.ValidateShippingDataSummaryPage">
    <parameter name="FirstName" value="${BillingAddressFirstName}"/>
    <parameter name="LastName" value="${BillingAddressLastName}"/>
    <parameter name="Address" value="${BillingAddressStreet}"/>
    <parameter name="City" value="${BillingAddressCity}"/>
    <parameter name="StateShort" value="${BillingAddressStateShort}"/>
    <parameter name="ZipCode" value="${BillingAddressZipCode}"/>
    <parameter name="Country" value="${BillingAddressCountry}"/>
    <parameter name="ShippingMethod" value="${ShippingMethodName}"/>
    <parameter name="ShippingStatus" value="Not Shipped"/>
  </module>
  <module name="modules.checkout.summary.ValidateBillingAddressSummaryPage">
    <parameter name="Name" value="${BillingAddressFirstName} ${BillingAddressLastName}"/>
    <parameter name="Address" value="${BillingAddressStreet}"/>
    <parameter name="City" value="${BillingAddressCity}"/>
    <parameter name="StateShort" value="${BillingAddressStateShort}"/>
    <parameter name="ZipCode" value="${BillingAddressZipCode}"/>
    <parameter name="Country" value="${BillingAddressCountry}"/>
  </module>
  <module name="modules.checkout.ValidateNumberFormatsCheckoutPage"/>
  <module name="modules.checkout.summary.ValidatePaymentCreditCardSummaryPage">
    <parameter name="Type" value="${CreditCardTypeShort}"/>
    <parameter name="Last4" value="${CreditCardNumberLast4Digits}"/>
    <parameter name="ExpireMonthNumber" value="${CreditCardExpiryMonthNumber}"/>
    <parameter name="Expire_Year" value="${CreditCardExpiryYear}"/>
  </module>
  <action name="GoToGiftRegistry"/>
  <module name="modules.giftregistry.OpenGiftRegistryPage">
    <parameter name="LinkText" value="Gift Registry"/>
    <parameter name="Headline" value="Gift Registry Login"/>
  </module>
  <action name="SearchForGiftRegistry"/>
  <module name="modules.giftregistry.SearchForGiftRegistryAndValidateResult"/>
  <action name="ViewDetails"/>
  <command name="clickAndWait" target="css=.event-view a"/>
  <module name="modules.giftregistry.ValidateGiftRegistryDetails"/>
  <module name="modules.giftregistry.ValidateGiftRegistryProductRow">
    <comment>Validate quality purchased == 1</comment>
    <parameter name="ProductCount" value="2"/>
    <parameter name="ProductRow" value="1"/>
    <parameter name="ProductName" value="${ProductName}"/>
    <parameter name="ProductID" value="${ProductID}"/>
    <parameter name="ProductPrice" value="${ProductPrice}"/>
    <parameter name="QuantityPurchased" value="1"/>
  </module>
  <module name="modules.giftregistry.ValidateGiftRegistryProductRow">
    <parameter name="ProductCount" value="2"/>
    <parameter name="ProductRow" value="2"/>
    <parameter name="ProductName" value="${SecondProductName}"/>
    <parameter name="ProductID" value="${SecondProductID}"/>
    <parameter name="ProductPrice" value="${SecondProductPrice}"/>
    <parameter name="QuantityPurchased" value="0"/>
  </module>
  <action name="GoToHomepage"/>
  <module name="modules.staticelements.Return2Home"/>
</testcase>
