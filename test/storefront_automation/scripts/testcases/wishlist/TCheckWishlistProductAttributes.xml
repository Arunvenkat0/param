<?xml version="1.0" encoding="UTF-8"?>
<testcase version="3" xmlns="http://xlt.xceptance.com/xlt-script/2">
  <description>Checks for changing priority and quanity of wishlist items.
- search for a product
- add to wishlist
- register new user
- search for a second product and add it to the wisthlist
- change priority and quantity for each product on the wishlist
- logout and login again
- validate the priority and quantity changes
- make the wishlist public
- leave the second product private
- logout
- search for the wishlist
- validate the first product</description>
  <action name="OpenStartPage"/>
  <command name="open" value="${shopURL}"/>
  <command name="deleteAllVisibleCookies"/>
  <command name="open" value="${shopURL}"/>
  <action name="SearchFirstProduct"/>
  <module name="modules.search.SearchProductByIDOrName">
    <comment>Search for first product</comment>
    <parameter name="SearchText" value="${FirstProductID}"/>
  </module>
  <module name="modules.catalog.ValidateProductDetailsPageStructure"/>
  <module name="modules.catalog.ValidateProductDataOnDetailsPage">
    <parameter name="Name" value="${FirstProductName}"/>
    <parameter name="Price" value="${FirstProductPrice}"/>
  </module>
  <action name="AddToWishlistAndRegister"/>
  <module name="modules.wishlist.AddToWishlistAndRegister">
    <parameter name="ProductID" value="${FirstProductID}"/>
    <parameter name="ProductName" value="${FirstProductName}"/>
    <parameter name="ProductPrice" value="${FirstProductPrice}"/>
  </module>
  <action name="GoToHomepage"/>
  <module name="modules.staticelements.Return2Home"/>
  <action name="SearchSecondProduct"/>
  <module name="modules.search.SearchProductByIDOrName">
    <comment>Search for first product</comment>
    <parameter name="SearchText" value="${SecondProductID}"/>
  </module>
  <module name="modules.catalog.ValidateProductDetailsPageStructure"/>
  <module name="modules.catalog.ValidateProductDataOnDetailsPage">
    <parameter name="Name" value="${SecondProductName}"/>
    <parameter name="Price" value="${SecondProductPrice}"/>
  </module>
  <action name="AddToWishlist"/>
  <command name="clickAndWait" target="link=Add to Wishlist"/>
  <module name="modules.wishlist.ValidateAccountWishlistPageStructure"/>
  <command name="assertElementPresent" target="css=#dwfrm_wishlist_share button[name='dwfrm_wishlist_setListPublic']"/>
  <action name="ValidateSecondProductOnWishlist"/>
  <command name="assertXpathCount" target="id('primary')/table[@class='item-list']/tbody/tr" value="3">
    <comment>Validate the number of products plus the headline row</comment>
  </command>
  <module name="modules.wishlist.ValidateWishlistProductRow">
    <parameter name="TableRow" value="3"/>
    <parameter name="ProductName" value="${SecondProductName}"/>
    <parameter name="ProductID" value="${SecondProductID}"/>
    <parameter name="ProductPrice" value="${SecondProductPrice}"/>
  </module>
  <action name="ChangeWishlistAttributesFirstProduct"/>
  <command name="store" target="${RANDOM.Number(1,10)}" value="FirstProductQuantity"/>
  <command name="store" target="${RANDOM.Number(1,5)}" value="FirstProductPriority"/>
  <command name="type" target="id=dwfrm_wishlist_items_i0_quantity" value="${FirstProductQuantity}"/>
  <command name="select" target="id=dwfrm_wishlist_items_i0_priority" value="value=${FirstProductPriority}"/>
  <command name="clickAndWait" target="css=button[name='dwfrm_wishlist_items_i0_updateItem']"/>
  <action name="ChangeWishlistAttributesSecondProduct"/>
  <command name="store" target="${RANDOM.Number(1,10)}" value="SecondProductQuantity"/>
  <command name="store" target="${RANDOM.Number(1,5)}" value="SecondProductPriority"/>
  <command name="type" target="id=dwfrm_wishlist_items_i1_quantity" value="${SecondProductQuantity}"/>
  <command name="select" target="id=dwfrm_wishlist_items_i1_priority" value="value=${SecondProductPriority}"/>
  <command name="clickAndWait" target="css=button[name='dwfrm_wishlist_items_i1_updateItem']"/>
  <action name="GoToWelcomePage"/>
  <command name="waitForElementPresent" target="css=.user-account"/>
  <command name="clickAndWait" target="css=.user-account"/>
  <action name="Logout"/>
  <module name="modules.usermanagement.LogOutFromWelcomePage"/>
  <action name="LoginAgain"/>
  <module name="modules.usermanagement.LoginOnLoginPage">
    <parameter name="Email" value="${Email}"/>
    <parameter name="Password" value="${Password}"/>
  </module>
  <module name="modules.usermanagement.ValidateWelcomePage">
    <parameter name="FirstName" value="${UserFirstName}"/>
    <parameter name="LastName" value="${UserLastName}"/>
  </module>
  <action name="OpenWishlistAndCheckForPreviousChanges"/>
  <command name="clickAndWait" target="link=Wish List"/>
  <module name="modules.wishlist.ValidateAccountWishlistPageStructure"/>
  <module name="modules.wishlist.ValidateWishlistProductRow">
    <parameter name="TableRow" value="2"/>
    <parameter name="ProductName" value="${FirstProductName}"/>
    <parameter name="ProductID" value="${FirstProductID}"/>
    <parameter name="ProductPrice" value="${FirstProductPrice}"/>
  </module>
  <command name="assertValue" target="id=dwfrm_wishlist_items_i0_quantity" value="${FirstProductQuantity}"/>
  <command name="assertSelectedValue" target="id=dwfrm_wishlist_items_i0_priority" value="${FirstProductPriority}"/>
  <command name="assertSelectedValue" target="id=dwfrm_wishlist_items_i0_priority" value="${FirstProductPriority}"/>
  <command name="storeText" target="css=#dwfrm_wishlist_items_i0_priority option[selected]" value="FirstProductPriorityText"/>
  <module name="modules.wishlist.ValidateWishlistProductRow">
    <parameter name="TableRow" value="3"/>
    <parameter name="ProductName" value="${SecondProductName}"/>
    <parameter name="ProductID" value="${SecondProductID}"/>
    <parameter name="ProductPrice" value="${SecondProductPrice}"/>
  </module>
  <command name="assertValue" target="id=dwfrm_wishlist_items_i1_quantity" value="${SecondProductQuantity}"/>
  <command name="assertSelectedValue" target="id=dwfrm_wishlist_items_i1_priority" value="${SecondProductPriority}"/>
  <action name="MakeTheListPublic"/>
  <command name="clickAndWait" target="xpath=id('dwfrm_wishlist_share')//button[@name='dwfrm_wishlist_setListPublic']"/>
  <module name="modules.wishlist.ValidateAccountWishlistPageStructure"/>
  <command name="assertElementPresent" target="css=#dwfrm_wishlist_share button[name='dwfrm_wishlist_setListPrivate']">
    <comment>Checks if the button which makes the list private is present.</comment>
  </command>
  <command name="assertChecked" target="id=dwfrm_wishlist_items_i0_public">
    <comment>Checks if the product is marked as public.</comment>
  </command>
  <command name="assertChecked" target="id=dwfrm_wishlist_items_i1_public">
    <comment>Checks if the product is marked as public.</comment>
  </command>
  <action name="MakeTheSecondProductPrivate"/>
  <command name="uncheck" target="id=dwfrm_wishlist_items_i1_public"/>
  <command name="clickAndWait" target="css=button[name='dwfrm_wishlist_items_i1_updateItem']"/>
  <action name="GoToWelcomePage"/>
  <command name="waitForElementPresent" target="css=.user-account"/>
  <command name="clickAndWait" target="css=.user-account"/>
  <action name="LogoutAndGoToHomepage"/>
  <module name="modules.usermanagement.LogOutFromWelcomePage"/>
  <module name="modules.staticelements.Return2Home"/>
  <action name="OpenWishlistPage"/>
  <command name="clickAndWait" target="link=Wish List"/>
  <module name="modules.usermanagement.ValidateWishlistLoginPageStructure"/>
  <action name="FindAWishlist"/>
  <command name="type" target="id=dwfrm_wishlist_search_lastname" value="${UserLastName}"/>
  <command name="type" target="id=dwfrm_wishlist_search_firstname" value="${UserFirstName}"/>
  <command name="type" target="id=dwfrm_wishlist_search_email" value="${Email}"/>
  <command name="clickAndWait" target="css=#dwfrm_wishlist_search button[name='dwfrm_wishlist_search_search']">
    <comment>Click the search button.</comment>
  </command>
  <command name="assertText" target="css=#primary h1" value="glob:Find Someone's Wish List:">
    <comment>Validate headline on wishlist result page.</comment>
  </command>
  <command name="assertXpathCount" target="id('primary')/table[@class='wish-list-results-table']//tr" value="2">
    <comment>Checks if 2 table rows are present (result row + header row).</comment>
  </command>
  <action name="ViewTheWishlist"/>
  <command name="clickAndWait" target="css=.wish-list-results-table tr:nth-child(2) .view a"/>
  <command name="assertXpathCount" target="id('primary')//table[@class='item-list']/tbody/tr" value="2">
    <comment>Product row + header row</comment>
  </command>
  <module name="modules.wishlist.ValidatePublicWishlistPageStructure">
    <parameter name="FirstName" value="${UserFirstName}"/>
    <parameter name="LastName" value="${UserLastName}"/>
  </module>
  <module name="modules.wishlist.ValidateWishlistProductRow">
    <parameter name="TableRow" value="2"/>
    <parameter name="ProductName" value="${FirstProductName}"/>
    <parameter name="ProductID" value="${FirstProductID}"/>
    <parameter name="ProductPrice" value="${FirstProductPrice}"/>
  </module>
  <command name="assertText" target="css=.item-list tr:nth-child(2) .item-dashboard .option-quantity-desired .value" value="${FirstProductQuantity}"/>
  <command name="assertText" target="css=.item-list tr:nth-child(2) .item-dashboard .option-priority .value" value="${FirstProductPriorityText}"/>
  <action name="GoToHomepage"/>
  <module name="modules.staticelements.Return2Home"/>
</testcase>