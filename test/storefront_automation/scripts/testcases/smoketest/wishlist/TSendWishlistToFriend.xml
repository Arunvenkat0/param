<?xml version="1.0" encoding="UTF-8" ?>
<testcase version="3" junit-test="true" xmlns="http://xlt.xceptance.com/xlt-script/2">
  <tags>C85036</tags>
  <description>Performs the following steps:
- search for a product
- add to wishlist
- register new user
- validate product data on the wishlist
- send this wishlist to a friend

Preview Overlay Validation broken by RAP-2485</description>
  <module name="modules.staticelements.Homepage"/>
  <action name="SearchProduct"/>
  <module name="modules.search.SearchProductByIDOrName">
    <comment>Search for first product</comment>
    <parameter name="SearchText" value="${ProductName}"/>
  </module>
  <module name="modules.catalog.ValidateProductDetailsPageStructure"/>
  <module name="modules.catalog.ValidateProductDataOnDetailsPage">
    <parameter name="Name" value="${ProductName}"/>
    <parameter name="Price" value="${ProductPrice}"/>
  </module>
  <action name="AddToWishlistAndRegister"/>
  <module name="modules.wishlist.AddToWishlistAndRegister">
    <parameter name="ProductID" value="${ProductID}"/>
    <parameter name="ProductName" value="${ProductName}"/>
    <parameter name="ProductPrice" value="${ProductPrice}"/>
  </module>
  <action name="SendWishlistToFriend"/>
  <command name="click" target="id=send-to-friend"/>
  <command name="waitForText" target="id=ui-dialog-title-send-to-friend-dialog" value="regexpi:Send to a Friend"/>
  <command name="assertValue" target="id=dwfrm_sendtofriend_yourname" value="${UserFirstName} ${UserLastName}"/>
  <command name="assertTextPresent" value="${Email}"/>
  <action name="EnterFormData"/>
  <command name="type" target="id=dwfrm_sendtofriend_friendsname" value="${FriendsName}"/>
  <command name="store" target="${RANDOM.String(8)}@varmail.de" value="FriendsEmail"/>
  <command name="type" target="id=dwfrm_sendtofriend_friendsemail" value="${FriendsEmail}"/>
  <command name="type" target="id=dwfrm_sendtofriend_confirmfriendsemail" value="${FriendsEmail}"/>
  <command name="store" target="${RANDOM.String(125)}" value="Message"/>
  <command name="type" target="id=dwfrm_sendtofriend_message" value="${Message}"/>
  <command name="assertText" target="css=.char-count" value="You have 125 characters left out of 250"/>
  <action name="OpenPreview"/>
  <command name="click" target="css=#send-to-friend-main .preview-button"/>
  <command name="waitForText" target="css=#send-to-friend-main h2" value="Review Your Message"/>
  <command name="assertText" target="css=.send-to-friend-product" value="glob:To:*${FriendsName}*${FriendsEmail}*"/>
  <command name="assertText" target="css=.send-to-friend-product" value="glob:*From:*${UserFirstName} ${UserLastName}*${Email}*"/>
  <command name="assertText" target="css=.send-to-friend-product" value="glob:*Message:*${Message}*"/>
  <action name="SendMessage"/>
  <command name="click" target="css=#send-to-friend-dialog .send-button"/>
  <command name="waitForTextPresent" value="Your message has been sent."/>
  <action name="CloseConfirmationDialog"/>
  <command name="click" target="css=.close-button"/>
  <module name="modules.wishlist.ValidateAccountWishlistPageStructure"/>
  <action name="GoToWelcomePage"/>
  <command name="waitForElementPresent" target="css=.user-account"/>
  <command name="clickAndWait" target="css=.user-account"/>
  <action name="LogoutAndGoToHomepage"/>
  <module name="modules.usermanagement.LogOutFromWelcomePage"/>
  <action name="GoToHome"/>
  <module name="modules.staticelements.Return2Home"/>
</testcase>
