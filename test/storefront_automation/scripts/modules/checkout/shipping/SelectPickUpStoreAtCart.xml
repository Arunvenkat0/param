<?xml version="1.0" encoding="UTF-8"?>
<scriptmodule xmlns="http://xlt.xceptance.com/xlt-script/2" version="4">
  <description>Clicks the store link for a product and searches for a zip code. After selecting the first store at the result list the overlay closes. 
Overlay is opened again to do another search by clicking change location link.
Another zip code is used for the second search.</description>
  <parameter name="ZipCodeStore1"/>
  <parameter name="ZipCodeStore2"/>
  <action name="OpenStoreSelectionOverlay"/>
  <module name="library.function.FClick">
    <parameter name="clickElement" value="link=Select Store"/>
  </module>
  <module name="library.function.FType">
    <parameter name="typeElement" value="id=userZip"/>
    <parameter name="inputString" value="@{ZipCodeStore1}"/>
  </module>
  <action name="SearchForStoreZipCode1"/>
  <module name="library.function.FClick">
    <parameter name="clickElement" value="id=set-user-zip"/>
  </module>
  <module name="library.function.FAssertCaseInsensitiveTextOnPage">
    <parameter name="text" value="@{ZipCodeStore1}"/>
  </module>
  <command name="assertElementPresent" target="css=.update-location"/>
  <command name="waitForElementPresent" target="css=.store-list .store-tile"/>
  <command name="assertElementPresent" target="css=.select-store-button"/>
  <command name="assertElementPresent" target="css=#listings-nav"/>
  <action name="SelectPickUpStore1"/>
  <module name="library.function.FClick">
    <parameter name="clickElement" value="css=.select-store-button"/>
  </module>
  <command name="waitForElementPresent" target="css=.selected-store-address"/>
  <action name="OpenStoreSelectionOverlayAgain"/>
  <module name="library.function.FClick">
    <parameter name="clickElement" value="link=Select Store"/>
  </module>
  <module name="library.function.FClick">
    <parameter name="clickElement" value="css=.update-location"/>
  </module>
  <module name="library.function.FType">
    <parameter name="typeElement" value="id=userZip"/>
    <parameter name="inputString" value="@{ZipCodeStore2}"/>
  </module>
  <action name="SearchForStoreZipCode2"/>
  <module name="library.function.FClick">
    <parameter name="clickElement" value="id=set-user-zip"/>
  </module>
  <module name="library.function.FAssertCaseInsensitiveTextOnPage">
    <parameter name="text" value="@{ZipCodeStore2}"/>
  </module>
  <command name="assertElementPresent" target="css=.update-location"/>
  <command name="assertElementPresent" target="css=.store-list .store-tile"/>
  <command name="assertElementPresent" target="css=.select-store-button"/>
  <command name="assertElementPresent" target="css=#listings-nav"/>
  <action name="SelectPickUpStore2"/>
  <module name="library.function.FClickAndWaitFor">
    <parameter name="clickElement" value="css=.select-store-button"/>
    <parameter name="waitForElement" value="css=.selected-store-address"/>
  </module>
</scriptmodule>