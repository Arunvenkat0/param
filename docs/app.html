<!DOCTYPE html>  <html> <head>   <title>app.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="app.html">                 app.js               </a>                                           <a class="source" href="responsive.html">                 responsive.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               app.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>app.js 2.0.0
   (c) 2009-2012 Demandware Inc.
   Subject to standard usage terms and conditions
   Relies on jQuery, jQuery UI, jQuery validate, ...
   For all details and documentation:
   https://github.com/Demandware/Site-Genesis</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>All java script logic for the application.
The code relies on the jQuery JS library to be also loaded. </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>semi-colon to assure functionality upon script concatenation and minification</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">;</span> </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>if jQuery has not been loaded, load from google cdn</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
	<span class="nx">s</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span> <span class="s1">&#39;https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js&#39;</span><span class="p">);</span>
	<span class="nx">s</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;text/javascript&#39;</span><span class="p">);</span>
	<span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>Application singleton and namespace object</h2>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="o">=</span><span class="s2">&quot;dw=1&quot;</span><span class="p">;</span>
	<span class="cm">/******** private functions &amp; vars **********/</span>
	</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>cache dom elements accessed multiple times
app.ui holds globally available elements</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">function</span> <span class="nx">initUiCache</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">app</span><span class="p">.</span><span class="nx">ui</span> <span class="o">=</span> <span class="p">{</span>
			<span class="nx">searchContainer</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#navigation .header-search&quot;</span><span class="p">),</span>
			<span class="nx">printPage</span>		<span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;a.print-page&quot;</span><span class="p">),</span>
			<span class="nx">reviewsContainer</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#pwrwritediv&quot;</span><span class="p">),</span>
			<span class="nx">main</span>			<span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#main&quot;</span><span class="p">),</span>
			<span class="nx">primary</span>			<span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#primary&quot;</span><span class="p">),</span>
			<span class="nx">secondary</span>		<span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#secondary&quot;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>elements found in content slots</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">slots</span> <span class="o">:</span> <span class="p">{</span>
				<span class="nx">subscribeEmail</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.subscribe-email&quot;</span><span class="p">)</span>
			<span class="p">}</span>
		<span class="p">};</span>		
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">controlKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;8&quot;</span><span class="p">,</span> <span class="s2">&quot;13&quot;</span><span class="p">,</span> <span class="s2">&quot;46&quot;</span><span class="p">,</span> <span class="s2">&quot;45&quot;</span><span class="p">,</span> <span class="s2">&quot;36&quot;</span><span class="p">,</span> <span class="s2">&quot;35&quot;</span><span class="p">,</span> <span class="s2">&quot;38&quot;</span><span class="p">,</span> <span class="s2">&quot;37&quot;</span><span class="p">,</span> <span class="s2">&quot;40&quot;</span><span class="p">,</span> <span class="s2">&quot;39&quot;</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>apply dialogify event handler to all elements that match
one or more of the specified selectors</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.dialogify, [data-dlg-options], [data-dlg-action]&quot;</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">setDialogify</span><span class="p">)</span>
		<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;keydown&quot;</span><span class="p">,</span> <span class="s2">&quot;textarea[data-character-limit]&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">()),</span>
				<span class="nx">charsLimit</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;character-limit&quot;</span><span class="p">),</span>
				<span class="nx">charsUsed</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
							
				<span class="k">if</span> <span class="p">((</span><span class="nx">charsUsed</span> <span class="o">&gt;=</span> <span class="nx">charsLimit</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">controlKeys</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>					
					<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
				<span class="p">}</span>					
		<span class="p">})</span>
		<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change keyup mouseup&quot;</span><span class="p">,</span> <span class="s2">&quot;textarea[data-character-limit]&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">()),</span>
				<span class="nx">charsLimit</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;character-limit&quot;</span><span class="p">),</span>
				<span class="nx">charsUsed</span> <span class="o">=</span> <span class="nx">text</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
				<span class="nx">charsRemain</span> <span class="o">=</span> <span class="nx">charsLimit</span> <span class="o">-</span> <span class="nx">charsUsed</span><span class="p">;</span>
			
			<span class="k">if</span><span class="p">(</span><span class="nx">charsRemain</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span> <span class="nx">text</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">charsRemain</span><span class="p">)</span> <span class="p">);</span>
				<span class="nx">charsRemain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
			
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">next</span><span class="p">(</span><span class="s1">&#39;div.char-count&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.char-remain-count&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">charsRemain</span><span class="p">);</span>
		<span class="p">});</span>
		</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>initialize search suggestions</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">app</span><span class="p">.</span><span class="nx">searchsuggest</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">searchContainer</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">SIMPLE_SEARCH</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>print handler</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">app</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">printPage</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nb">window</span><span class="p">.</span><span class="nx">print</span><span class="p">();</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>add show/hide navigation elements</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.secondary-navigation .toggle&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;expanded&#39;</span><span class="p">).</span><span class="nx">next</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
		<span class="p">});</span>
		</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>add generic toggle functionality</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.toggle&#39;</span><span class="p">).</span><span class="nx">next</span><span class="p">(</span><span class="s1">&#39;.toggle-content&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
		<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.toggle&#39;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;expanded&#39;</span><span class="p">).</span><span class="nx">next</span><span class="p">(</span><span class="s1">&#39;.toggle-content&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
		<span class="p">});</span>
		</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>subscribe email box</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">slots</span><span class="p">.</span><span class="nx">subscribeEmail</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>	<span class="p">{</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">slots</span><span class="p">.</span><span class="nx">subscribeEmail</span><span class="p">.</span><span class="nx">focus</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">val</span><span class="p">());</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">val</span> <span class="o">!==</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">SUBSCRIBE_EMAIL_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span><span class="p">;</span> <span class="c1">// do not animate when contains non-default value</span>
				<span class="p">}</span>

				<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;#999999&#39;</span><span class="p">},</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="s1">&#39;#333333&#39;</span><span class="p">);</span>
				<span class="p">});</span>
			<span class="p">}).</span><span class="nx">blur</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">val</span><span class="p">()));</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span><span class="p">;</span> <span class="c1">// do not animate when contains value</span>
				<span class="p">}</span>

				<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">SUBSCRIBE_EMAIL_DEFAULT</span><span class="p">)</span>
					   <span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="s1">&#39;#999999&#39;</span><span class="p">)</span>
					   <span class="p">.</span><span class="nx">animate</span><span class="p">({</span><span class="nx">color</span><span class="o">:</span> <span class="s1">&#39;#333333&#39;</span><span class="p">},</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">);</span>

			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeDom</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>add class to html for css targeting</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;js&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>load js specific styles</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">loadCssFile</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">staticUrl</span><span class="p">(</span><span class="s2">&quot;/css/js-style.css&quot;</span><span class="p">));</span>		
		<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">limitCharacters</span><span class="p">();</span>
	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>_app object
"inherits" app object via $.extend() at the end of this seaf (Self-Executing Anonymous Function</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">_app</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">containerId</span>		<span class="o">:</span> <span class="s2">&quot;content&quot;</span><span class="p">,</span>
		<span class="nx">ProductCache</span>	<span class="o">:</span> <span class="kc">null</span><span class="p">,</span>  <span class="c1">// app.Product object ref to the current/main product</span>
		<span class="nx">ProductDetail</span>	<span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
		<span class="nx">clearDivHtml</span>	<span class="o">:</span> <span class="s1">&#39;&lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">,</span>
		<span class="nx">currencyCodes</span>	<span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">currencyCodes</span> <span class="o">||</span> <span class="p">{},</span> <span class="c1">// holds currency code/symbol for the site</span>

		<span class="cm">/**</span>
<span class="cm">		 * @name init</span>
<span class="cm">		 * @function</span>
<span class="cm">		 * @description Master page initialization routine</span>
<span class="cm">		 */</span>
		<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			
			<span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div/&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;browser-compatibility-alert&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;p/&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;browser-error&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">COOKIES_DISABLED</span><span class="p">)).</span><span class="nx">appendTo</span><span class="p">(</span><span class="s2">&quot;#browser-check&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			
			</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>init global cache</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">initUiCache</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>init global dom elements</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">initializeDom</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>init global events</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">initializeEvents</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>init specific global components</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">app</span><span class="p">.</span><span class="nx">tooltips</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">searchplaceholder</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>execute page specific initializations</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">ns</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">ns</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">ns</span> <span class="o">&amp;&amp;</span> <span class="nx">app</span><span class="p">[</span><span class="nx">ns</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">app</span><span class="p">[</span><span class="nx">ns</span><span class="p">].</span><span class="nx">init</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">app</span><span class="p">[</span><span class="nx">ns</span><span class="p">].</span><span class="nx">init</span><span class="p">();</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">};</span>

	<span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">_app</span><span class="p">);</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>Home page (Storefront) singleton and namespace object</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>app.storefront</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">storefront</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$cache</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">slide</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.slide&#39;</span><span class="p">),</span>
				<span class="nx">slider</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#homepage-slider&#39;</span><span class="p">),</span>
				<span class="nx">wrapper</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#wrapper&#39;</span><span class="p">)</span>
			<span class="p">};</span>
			
			
			<span class="kd">function</span> <span class="nx">slideCarousel_initCallback</span><span class="p">(</span><span class="nx">carousel</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>create navigation for slideshow</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="kd">var</span> <span class="nx">numSlides</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#homepage-slider li&#39;</span><span class="p">).</span><span class="nx">size</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">slideShowNav</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;jcarousel-control&quot;&gt;&#39;</span><span class="p">;</span>
				<span class="k">for</span><span class="p">(</span> <span class="nx">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">numSlides</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">slideShowNav</span> <span class="o">=</span> <span class="nx">slideShowNav</span> <span class="o">+</span> <span class="s1">&#39;&lt;a href=&quot;#&quot; class=&quot;link-&#39;</span><span class="o">+</span><span class="nx">i</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="nx">slideShowNav</span> <span class="o">=</span> <span class="nx">slideShowNav</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
				<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#homepage-slider .jcarousel-clip&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">slideShowNav</span><span class="p">);</span>

			   <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.jcarousel-control a&#39;</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			        <span class="nx">carousel</span><span class="p">.</span><span class="nx">scroll</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">.</span><span class="nx">jcarousel</span><span class="p">.</span><span class="nx">intval</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">()));</span>
			        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
			    <span class="p">});</span>
			   
			   <span class="nx">$cache</span><span class="p">.</span><span class="nx">slide</span><span class="p">.</span><span class="nx">width</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">wrapper</span><span class="p">.</span><span class="nx">width</span><span class="p">());</span>
			   
			<span class="p">}</span>
			
			<span class="kd">function</span> <span class="nx">slideCarousel_itemVisible</span><span class="p">(</span><span class="nx">carousel</span><span class="p">,</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">idx</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>alert('Item #' + idx + ' is visible');</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.jcarousel-control a&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
				<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.jcarousel-control&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.link-&#39;</span><span class="o">+</span><span class="nx">idx</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">);</span>
			<span class="p">}</span>

			<span class="nx">$cache</span><span class="p">.</span><span class="nx">slider</span><span class="p">.</span><span class="nx">jcarousel</span><span class="p">({</span>
				<span class="nx">scroll</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
				<span class="nx">auto</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
				<span class="nx">buttonNextHTML</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
				<span class="nx">buttonPrevHTML</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
				<span class="nx">itemFallbackDimension</span><span class="o">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span>
				<span class="nx">initCallback</span><span class="o">:</span> <span class="nx">slideCarousel_initCallback</span><span class="p">,</span>
				<span class="nx">itemFirstInCallback</span><span class="o">:</span> <span class="nx">slideCarousel_itemVisible</span>
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h2>Tooltips singleton and namespace object</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>app.tooltips</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">tooltips</span> <span class="o">=</span> <span class="p">{</span>
			
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			
			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.tooltip&#39;</span><span class="p">).</span><span class="nx">tooltip</span><span class="p">({</span>
				<span class="nx">track</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
				<span class="nx">showURL</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
			    <span class="nx">bodyHandler</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>add a data attribute of data-layout="some-class" to your tooltip-content container if you want a custom class</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="kd">var</span> <span class="nx">tooltipClass</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
					<span class="k">if</span><span class="p">(</span> <span class="nx">tooltipClass</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.tooltip-content&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;layout&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">tooltipClass</span> <span class="o">=</span> <span class="s2">&quot; class=&#39;&quot;</span> <span class="o">+</span> <span class="nx">tooltipClass</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span><span class="p">;</span>
					<span class="p">}</span>
		        	<span class="k">return</span> <span class="s2">&quot;&lt;div &quot;</span> <span class="o">+</span> <span class="nx">tooltipClass</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.tooltip-content&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">;</span> 
				<span class="p">},</span> 
				<span class="nx">showURL</span><span class="o">:</span> <span class="kc">false</span> 
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span>


<span class="cm">/**</span>
<span class="cm"> @class app.product</span>
<span class="cm"> */</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span><span class="p">;</span>

	<span class="cm">/*************** app.product private vars and functions ***************/</span>
	<span class="kd">function</span> <span class="nx">loadProductNavigation</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">pidInput</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;pid&#39;]&quot;</span><span class="p">).</span><span class="nx">last</span><span class="p">();</span>
		<span class="kd">var</span> <span class="nx">navContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#product-nav-container&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>if no hash exists, or no pid exists, or nav container does not exist, return</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">||</span> <span class="nx">pidInput</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span> <span class="o">||</span> <span class="nx">navContainer</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="kd">var</span> <span class="nx">pid</span> <span class="o">=</span> <span class="nx">pidInput</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span>
		<span class="kd">var</span> <span class="nx">hashParams</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">hashParams</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;pid=&quot;</span><span class="o">+</span><span class="nx">pid</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">hashParams</span><span class="o">+=</span><span class="s2">&quot;&amp;pid=&quot;</span><span class="o">+</span><span class="nx">pid</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">productNav</span><span class="o">+</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">productNav</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s2">&quot;?&quot;</span> <span class="o">:</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">)</span><span class="o">+</span><span class="nx">hashParams</span><span class="p">;</span>
		<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span><span class="nx">url</span><span class="p">,</span> <span class="nx">target</span><span class="o">:</span> <span class="nx">navContainer</span><span class="p">});</span>
	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>creates product recommendation carousel using jQuery jcarousel plugin</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">function</span> <span class="nx">loadRecommendations</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">carousel</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#carousel-recomendations&quot;</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">carousel</span> <span class="o">||</span> <span class="nx">carousel</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">carousel</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="nx">carousel</span><span class="p">.</span><span class="nx">jcarousel</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">carouselSettings</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/**</span>
<span class="cm">	 @description Sets the main image attributes and the href for the surrounding &lt;a&gt; tag</span>
<span class="cm">	 @param {Object} atts Simple object with url, alt, title and hires properties</span>
<span class="cm">	 */</span>
	<span class="kd">function</span> <span class="nx">setMainImage</span><span class="p">(</span><span class="nx">atts</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">imgZoom</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;a.main-image&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">imgZoom</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">atts</span><span class="p">.</span><span class="nx">hires</span> <span class="o">&amp;&amp;</span> <span class="nx">atts</span><span class="p">.</span><span class="nx">hires</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">imgZoom</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">,</span> <span class="nx">atts</span><span class="p">.</span><span class="nx">hires</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="nx">imgZoom</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;img.primary-image&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
			<span class="s2">&quot;src&quot;</span> <span class="o">:</span> <span class="nx">atts</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
			<span class="s2">&quot;alt&quot;</span> <span class="o">:</span> <span class="nx">atts</span><span class="p">.</span><span class="nx">alt</span><span class="p">,</span>
			<span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="nx">atts</span><span class="p">.</span><span class="nx">title</span>
		<span class="p">});</span>
	<span class="p">}</span>

	<span class="cm">/**</span>
<span class="cm">	 @description helper function for swapping main image on swatch hover</span>
<span class="cm">	 @param {Element} element DOM element with custom data-lgimg attribute</span>
<span class="cm">	 */</span>
	<span class="kd">function</span> <span class="nx">swapImage</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">lgImg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;lgimg&quot;</span><span class="p">);</span>

		<span class="kd">var</span> <span class="nx">newImg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">lgImg</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">imgZoom</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;a.main-image&quot;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">mainImage</span> <span class="o">=</span> <span class="nx">imgZoom</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;img.primary-image&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>store current image info</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">lgImg</span><span class="p">.</span><span class="nx">hires</span> <span class="o">=</span> <span class="nx">imgZoom</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">);</span>
		<span class="nx">lgImg</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">mainImage</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">);</span>
		<span class="nx">lgImg</span><span class="p">.</span><span class="nx">alt</span> <span class="o">=</span> <span class="nx">mainImage</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;alt&quot;</span><span class="p">);</span>
		<span class="nx">lgImg</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">mainImage</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>reset element's lgimg data attribute</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">lgImg</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>set the main image</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">setMainImage</span><span class="p">(</span><span class="nx">newImg</span><span class="p">);</span>
	<span class="p">}</span>



	<span class="kd">function</span> <span class="nx">loadZoom</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">isActive</span><span class="p">()</span> <span class="o">||</span> <span class="o">!</span><span class="nx">app</span><span class="p">.</span><span class="nx">zoomViewerEnabled</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>zoom properties</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
			<span class="nx">zoomType</span><span class="o">:</span> <span class="s1">&#39;standard&#39;</span><span class="p">,</span>
			<span class="nx">alwaysOn</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">// setting to 1 will load load high res images on page load</span>
			<span class="nx">zoomWidth</span> <span class="o">:</span> <span class="mi">575</span><span class="p">,</span>
			<span class="nx">zoomHeight</span> <span class="o">:</span> <span class="mi">349</span><span class="p">,</span>
			<span class="nx">position</span><span class="o">:</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
			<span class="nx">preloadImages</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">// setting to 1 will load load high res images on page load</span>
			<span class="nx">xOffset</span><span class="o">:</span> <span class="mi">30</span><span class="p">,</span>
			<span class="nx">yOffset</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
			<span class="nx">showEffect</span> <span class="o">:</span> <span class="s1">&#39;fadein&#39;</span><span class="p">,</span>
			<span class="nx">hideEffect</span><span class="o">:</span> <span class="s1">&#39;fadeout&#39;</span>
		<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Added to prevent empty hires zoom feature (if images don't exist)</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">mainImage</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;a.main-image&quot;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">hiresImageSrc</span> <span class="o">=</span> <span class="nx">mainImage</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span> <span class="nx">hiresImageSrc</span> <span class="o">&amp;&amp;</span> <span class="nx">hiresImageSrc</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">hiresImageSrc</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;noimagelarge&#39;</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nx">mainImage</span><span class="p">.</span><span class="nx">removeData</span><span class="p">(</span><span class="s2">&quot;jqzoom&quot;</span><span class="p">).</span><span class="nx">jqzoom</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">replaceImages</span><span class="p">()</span> <span class="p">{</span>		
		<span class="kd">var</span> <span class="nx">newImages</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#update-images&quot;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">imageContainer</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;div.product-image-container&quot;</span><span class="p">);</span>
		
		<span class="nx">imageContainer</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">newImages</span><span class="p">.</span><span class="nx">html</span><span class="p">());</span>
		<span class="nx">newImages</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
		<span class="nx">setMainImageLink</span><span class="p">();</span>
		
		<span class="nx">loadZoom</span><span class="p">();</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">setMainImageLink</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">isActive</span><span class="p">()</span> <span class="o">||</span> <span class="nx">app</span><span class="p">.</span><span class="nx">isMobileUserAgent</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;a.main-image&quot;</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;a.main-image&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;image-zoom&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">removeImageZoom</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;a.main-image&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;image-zoom&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">initializeDom</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.product-detail .product-tabs&#39;</span><span class="p">).</span><span class="nx">tabs</span><span class="p">();</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pwrwritediv&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">settings</span><span class="p">,</span> <span class="p">{</span>
				<span class="nx">autoOpen</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
				<span class="nx">height</span> <span class="o">:</span> <span class="mi">750</span><span class="p">,</span>
				<span class="nx">width</span> <span class="o">:</span> <span class="mi">650</span><span class="p">,</span>
				<span class="nx">dialogClass</span> <span class="o">:</span> <span class="s1">&#39;writereview&#39;</span><span class="p">,</span>
				<span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Product Review&#39;</span><span class="p">,</span>
				<span class="nx">resizable</span> <span class="o">:</span> <span class="kc">false</span>
			<span class="p">});</span>

			<span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
				<span class="nx">target</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">ui</span><span class="p">.</span><span class="nx">reviewsContainer</span><span class="p">,</span>
				<span class="nx">options</span> <span class="o">:</span> <span class="nx">options</span>
			<span class="p">});</span>
		<span class="p">}</span>

		<span class="nx">loadRecommendations</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">);</span>
		<span class="nx">loadProductNavigation</span><span class="p">();</span>
		<span class="nx">setMainImageLink</span><span class="p">();</span>		

		<span class="k">if</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">productSetList</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">unavailable</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">productSetList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;button.add-to-cart[disabled]&quot;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">unavailable</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addAllToCart</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span> <span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addToCart</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span> <span class="s2">&quot;disabled&quot;</span><span class="p">);</span> <span class="c1">// this may be a bundle</span>

			<span class="p">}</span>
		<span class="p">}</span>
		
		<span class="nx">app</span><span class="p">.</span><span class="nx">tooltips</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeCache</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span> <span class="o">=</span> <span class="p">{</span>
			<span class="nx">productId</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#pid&quot;</span><span class="p">),</span>
			<span class="nx">pdpMain</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#pdpMain&quot;</span><span class="p">),</span>
			<span class="nx">productContent</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#product-content&quot;</span><span class="p">),</span>
			<span class="nx">thumbnails</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#thumbnails&quot;</span><span class="p">),</span>
			<span class="nx">bonusProductGrid</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.bonusproductgrid&quot;</span><span class="p">),</span>
			<span class="nx">imageContainer</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.product-primary-image&quot;</span><span class="p">),</span>
			<span class="nx">productSetList</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#product-set-list&quot;</span><span class="p">),</span>
			<span class="nx">addToCart</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#add-to-cart&quot;</span><span class="p">),</span>
			<span class="nx">addAllToCart</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#add-all-to-cart&quot;</span><span class="p">)</span>
		<span class="p">};</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">detailContent</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;div.detail-content&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpForm</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;form.pdpForm&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">swatches</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;ul.swatches&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">mainImageAnchor</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">imageZoom</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">imageContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;a.main-image&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">mainImage</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">mainImageAnchor</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;img.primary-image&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span>
		
		<span class="kd">var</span> <span class="nx">availabilityContainer</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;div.availability&quot;</span><span class="p">);</span>
		
		<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">initAddThis</span><span class="p">();</span>
		</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>add or update shopping cart line item</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">initAddToCart</span><span class="p">();</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change keyup&quot;</span><span class="p">,</span> <span class="s2">&quot;form.pdpForm input[name=&#39;Quantity&#39;]&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">getAvailability</span><span class="p">(</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">productId</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
				<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
				<span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">$cache</span><span class="p">.</span><span class="nx">addToCart</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
						<span class="nx">availabilityContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.availability-qty-available&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">();</span>
						<span class="nx">availabilityContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.availability-msg&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
						<span class="k">return</span><span class="p">;</span>
					<span class="p">}</span><span class="k">else</span><span class="p">{</span>
						<span class="kd">var</span> <span class="nx">avMsg</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
						<span class="kd">var</span> <span class="nx">avRoot</span> <span class="o">=</span> <span class="nx">availabilityContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.availability-msg&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
						</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Look through levels ... if msg is not empty, then create span el</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">if</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">IN_STOCK</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
							<span class="nx">avMsg</span> <span class="o">=</span> <span class="nx">avRoot</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.in-stock-msg&quot;</span><span class="p">);</span>
							<span class="k">if</span> <span class="p">(</span><span class="nx">avMsg</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
								<span class="nx">avMsg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;p/&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;in-stock-msg&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">avRoot</span><span class="p">);</span>
							<span class="p">}</span>
							<span class="k">if</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">PREORDER</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">BACKORDER</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">NOT_AVAILABLE</span><span class="o">==</span><span class="mi">0</span> <span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Just in stock</p>             </td>             <td class="code">               <div class="highlight"><pre>								<span class="nx">avMsg</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">IN_STOCK</span><span class="p">);</span>
							<span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>In stock with conditions ...</p>             </td>             <td class="code">               <div class="highlight"><pre>								<span class="nx">avMsg</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">inStockMsg</span><span class="p">);</span>
							<span class="p">}</span>
						<span class="p">}</span>
						<span class="k">if</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">PREORDER</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
							<span class="nx">avMsg</span> <span class="o">=</span> <span class="nx">avRoot</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.preorder-msg&quot;</span><span class="p">);</span>
							<span class="k">if</span> <span class="p">(</span><span class="nx">avMsg</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
								<span class="nx">avMsg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;p/&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;preorder-msg&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">avRoot</span><span class="p">);</span>
							<span class="p">}</span>
							<span class="k">if</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">IN_STOCK</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">BACKORDER</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">NOT_AVAILABLE</span><span class="o">==</span><span class="mi">0</span> <span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Just in stock</p>             </td>             <td class="code">               <div class="highlight"><pre>								<span class="nx">avMsg</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">PREORDER</span><span class="p">);</span>
							<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
								<span class="nx">avMsg</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">preOrderMsg</span><span class="p">);</span>
							<span class="p">}</span>
						<span class="p">}</span>
						<span class="k">if</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">BACKORDER</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
							<span class="nx">avMsg</span> <span class="o">=</span> <span class="nx">avRoot</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.backorder-msg&quot;</span><span class="p">);</span>
							<span class="k">if</span> <span class="p">(</span><span class="nx">avMsg</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
								<span class="nx">avMsg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;p/&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;backorder-msg&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">avRoot</span><span class="p">);</span>
							<span class="p">}</span>
							<span class="k">if</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">IN_STOCK</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">PREORDER</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">NOT_AVAILABLE</span><span class="o">==</span><span class="mi">0</span> <span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Just in stock</p>             </td>             <td class="code">               <div class="highlight"><pre>								<span class="nx">avMsg</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">BACKORDER</span><span class="p">);</span>
							<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
								<span class="nx">avMsg</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">backOrderMsg</span><span class="p">);</span>
							<span class="p">}</span>
						<span class="p">}</span>
						<span class="k">if</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">inStockDate</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="p">)</span> <span class="p">{</span>
							<span class="nx">avMsg</span> <span class="o">=</span> <span class="nx">avRoot</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.in-stock-date-msg&quot;</span><span class="p">);</span>
							<span class="k">if</span> <span class="p">(</span><span class="nx">avMsg</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
								<span class="nx">avMsg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;p/&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;in-stock-date-msg&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">avRoot</span><span class="p">);</span>
							<span class="p">}</span>
							<span class="nx">avMsg</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">IN_STOCK_DATE</span><span class="p">,</span><span class="nx">data</span><span class="p">.</span><span class="nx">inStockDate</span><span class="p">));</span>
						<span class="p">}</span>
						<span class="k">if</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">NOT_AVAILABLE</span><span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
							<span class="nx">avMsg</span> <span class="o">=</span> <span class="nx">avRoot</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.not-available-msg&quot;</span><span class="p">);</span>
							<span class="k">if</span> <span class="p">(</span><span class="nx">avMsg</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
								<span class="nx">avMsg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;p/&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;not-available-msg&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">avRoot</span><span class="p">);</span>
							<span class="p">}</span>
							<span class="k">if</span><span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">PREORDER</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">BACKORDER</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">IN_STOCK</span><span class="o">==</span><span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
								<span class="nx">avMsg</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">NOT_AVAILABLE</span><span class="p">);</span>
							<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
								<span class="nx">avMsg</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">REMAIN_NOT_AVAILABLE</span><span class="p">);</span>
							<span class="p">}</span>
						<span class="p">}</span>
						<span class="k">return</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">addToCart</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span> <span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
					<span class="nx">availabilityContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.availability-msg&quot;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
					<span class="kd">var</span> <span class="nx">avQtyMsg</span> <span class="o">=</span> <span class="nx">availabilityContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.availability-qty-available&quot;</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">avQtyMsg</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">avQtyMsg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;span/&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;availability-qty-available&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">availabilityContainer</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="nx">avQtyMsg</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">inStockMsg</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
					
					<span class="kd">var</span> <span class="nx">avQtyMsg</span> <span class="o">=</span> <span class="nx">availabilityContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.availability-qty-available&quot;</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">avQtyMsg</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">avQtyMsg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;span/&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;availability-qty-available&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">availabilityContainer</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="nx">avQtyMsg</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">backorderMsg</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
				<span class="p">});</span>

		<span class="p">});</span>
		</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Add to Wishlist and Add to Gift Registry links behaviors</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;a.wl-action&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			
			<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getQueryStringParams</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpForm</span><span class="p">.</span><span class="nx">serialize</span><span class="p">());</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">cartAction</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">delete</span> <span class="nx">data</span><span class="p">.</span><span class="nx">cartAction</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
			<span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">+</span> <span class="s2">&quot;//&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="p">((</span><span class="nx">url</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">===</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">url</span> <span class="o">:</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nx">url</span><span class="p">));</span>
			<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
		<span class="p">});</span>

		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;hover&quot;</span><span class="p">,</span> <span class="s2">&quot;ul.Color a.swatchanchor&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">swapImage</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>productthumbnail.onclick()</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;img.productthumbnail&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">lgImg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;lgimg&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>switch indicator</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;div.product-thumbnails li.selected&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;selected&quot;</span><span class="p">);</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;li&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;selected&quot;</span><span class="p">);</span>

			<span class="nx">setMainImage</span><span class="p">(</span><span class="nx">lgImg</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>load zoom if not quick view</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span> <span class="nx">lgImg</span><span class="p">.</span><span class="nx">hires</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">lgImg</span><span class="p">.</span><span class="nx">hires</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;noimagelarge&#39;</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span> <span class="p">){</span>
				<span class="nx">setMainImageLink</span><span class="p">();</span>
				<span class="nx">loadZoom</span><span class="p">();</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="nx">removeImageZoom</span><span class="p">();</span>
			<span class="p">}</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>dropdown variations</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="s2">&quot;.product-options select&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">salesPrice</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;div.product-add-to-cart .price-sales&quot;</span><span class="p">);</span>
			
			<span class="kd">var</span> <span class="nx">selectedItem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">children</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;:selected&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">combinedPrice</span> <span class="o">=</span> <span class="nx">selectedItem</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;combined&quot;</span><span class="p">);</span>
			<span class="nx">salesPrice</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">combinedPrice</span><span class="p">);</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>prevent default behavior of thumbnail link and add this Button</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.thumbnail-link, .addthis_toolbox a&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;li.unselectable a&quot;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
		</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>handle drop down variation attribute value selection event</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="s2">&quot;.variation-select&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span><span class="p">;}</span>
			<span class="kd">var</span> <span class="nx">qty</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;Quantity&#39;]&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">val</span><span class="p">(),</span>
				<span class="nx">productSet</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.subProduct&#39;</span><span class="p">),</span>
				<span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">Quantity</span> <span class="o">:</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">qty</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;1&quot;</span> <span class="o">:</span> <span class="nx">qty</span><span class="p">,</span>
					<span class="nx">format</span> <span class="o">:</span> <span class="s2">&quot;ajax&quot;</span>
				<span class="p">};</span>
						
			<span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="p">(</span><span class="nx">productSet</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">productSet</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="nx">productSet</span> <span class="o">:</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">productContent</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span> <span class="nx">params</span><span class="p">);</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">);</span>

			<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span>
				<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
				<span class="nx">callback</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">target</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">initAddThis</span><span class="p">();</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">initAddToCart</span><span class="p">();</span>
					<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;update-images&quot;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">tooltips</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
				<span class="p">}</span>
			<span class="p">});</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>swatch anchor onclick()</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;div.product-detail a[href].swatchanchor&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parent</span><span class="p">(</span><span class="s2">&quot;li&quot;</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;selected&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			
			<span class="kd">var</span> <span class="nx">isColor</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;ul.swatches&quot;</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;Color&quot;</span><span class="p">);</span>
						
			<span class="kd">var</span> <span class="nx">anchor</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
				<span class="nx">qty</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;Quantity&#39;]&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">val</span><span class="p">(),</span>
				<span class="nx">productSet</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">anchor</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.subProduct&#39;</span><span class="p">),</span>
				<span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">Quantity</span> <span class="o">:</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">qty</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;1&quot;</span> <span class="o">:</span> <span class="nx">qty</span>
				<span class="p">};</span>
			
			<span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="p">(</span><span class="nx">productSet</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">productSet</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="nx">productSet</span> <span class="o">:</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">productContent</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">);</span>		
						
			<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span>
				<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
				<span class="nx">callback</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">target</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">initAddThis</span><span class="p">();</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">initAddToCart</span><span class="p">();</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">isColor</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">replaceImages</span><span class="p">();</span>
					<span class="p">}</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">tooltips</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
				<span class="p">}</span>
			<span class="p">});</span>
		<span class="p">});</span>

		<span class="nx">$cache</span><span class="p">.</span><span class="nx">productSetList</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;div.product-set-item li a[href].swatchanchor&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>get the querystring from the anchor element</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getQueryStringParams</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">search</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">psItem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.product-set-item&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>set quantity to value from form</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">qty</span> <span class="o">=</span> <span class="nx">psItem</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;Quantity&#39;]&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">val</span><span class="p">();</span>
			<span class="nx">params</span><span class="p">.</span><span class="nx">Quantity</span> <span class="o">=</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">qty</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;1&quot;</span> <span class="o">:</span> <span class="nx">qty</span><span class="p">;</span>

			<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">getSetItem</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>get container</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">ic</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.product-set-item&quot;</span><span class="p">);</span>
			<span class="nx">ic</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">productSetList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;button.add-to-cart[disabled]&quot;</span><span class="p">).</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">addAllToCart</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span><span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">addToCart</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span><span class="s2">&quot;disabled&quot;</span><span class="p">);</span> <span class="c1">// this may be a bundle</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">addAllToCart</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">addToCart</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">);</span> <span class="c1">// this may be a bundle</span>
				<span class="p">}</span>
				
				<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">initAddToCart</span><span class="p">(</span><span class="nx">ic</span><span class="p">);</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">tooltips</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="p">});</span>
		<span class="p">});</span>

		<span class="nx">$cache</span><span class="p">.</span><span class="nx">addAllToCart</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">psForms</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">productSetList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">).</span><span class="nx">toArray</span><span class="p">(),</span>
				<span class="nx">miniCartHtml</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
				<span class="nx">addProductUrl</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">ajaxUrl</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">addProduct</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>add items to cart</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">function</span> <span class="nx">addItems</span><span class="p">()</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">psForms</span><span class="p">.</span><span class="nx">shift</span><span class="p">());</span>
				<span class="kd">var</span> <span class="nx">itemid</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;pid&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>

				<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
					<span class="nx">dataType</span> <span class="o">:</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span>
					<span class="nx">url</span><span class="o">:</span> <span class="nx">addProductUrl</span><span class="p">,</span>
					<span class="nx">data</span><span class="o">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span>
				<span class="p">})</span>
				<span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>success</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">miniCartHtml</span> <span class="o">=</span> <span class="nx">response</span><span class="p">;</span>
				<span class="p">})</span>
				<span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>failed</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">ADD_TO_CART_FAIL</span><span class="p">;</span>
					<span class="nx">$</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="nx">itemid</span><span class="p">);</span>
					<span class="k">if</span><span class="p">(</span><span class="nx">textStatus</span> <span class="o">===</span> <span class="s2">&quot;parsererror&quot;</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">msg</span><span class="o">+=</span><span class="s2">&quot;\n&quot;</span><span class="o">+</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">BAD_RESPONSE</span><span class="p">;</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="nx">msg</span><span class="o">+=</span><span class="s2">&quot;\n&quot;</span><span class="o">+</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">SERVER_CONNECTION_ERROR</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
				<span class="p">})</span>
				<span class="p">.</span><span class="nx">always</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">psForms</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">addItems</span><span class="p">();</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">miniCartHtml</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">});</span>
			<span class="p">}</span>
			<span class="nx">addItems</span><span class="p">();</span>
			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">});</span>
		<span class="nx">app</span><span class="p">.</span><span class="nx">sendToFriend</span><span class="p">.</span><span class="nx">initializeDialog</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">,</span> <span class="s2">&quot;a.send-to-friend&quot;</span><span class="p">);</span>
		
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;button.add-to-cart[disabled]&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">pdpMain</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.availability-msg&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">()</span> <span class="p">);</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">setAddToCartHandler</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>		
		<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">qty</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;Quantity&#39;]&quot;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">isSubItem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;sub-product-item&quot;</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">qty</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">qty</span><span class="p">.</span><span class="nx">val</span><span class="p">())</span> <span class="o">||</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">qty</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">qty</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		
		<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">();</span>
		<span class="nx">app</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">uuid</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;uuid&#39;]&quot;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">uuid</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">uuid</span><span class="p">.</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="p">{</span>				
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isSubItem</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
				<span class="p">}</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">});</span>
	<span class="p">}</span>
	
	

	<span class="cm">/*************** app.product public object ***************/</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">product</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">initializeCache</span><span class="p">();</span>
			<span class="nx">initializeDom</span><span class="p">();</span>
			<span class="nx">initializeEvents</span><span class="p">();</span>
			<span class="nx">loadZoom</span><span class="p">();</span>
		<span class="p">},</span>
		<span class="nx">get</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>loads a product into a given container div
params
    containerId - id of the container div, if empty then global app.containerId is used
    source - source string e.g. search, cart etc.
    label - label for the add to cart button, default is Add to Cart
    url - url to get the product
    id - id of the product to get, is optional only used when url is empty</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">source</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

			<span class="kd">var</span> <span class="nx">productUrl</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">url</span> <span class="o">||</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamToURL</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">getProductUrl</span><span class="p">,</span> <span class="s2">&quot;pid&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">source</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">productUrl</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamToURL</span><span class="p">(</span><span class="nx">productUrl</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="nx">source</span><span class="p">);</span>
			<span class="p">}</span>			</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>show small loading image
app.progress.show(app.ui.primary);</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span>
				<span class="nx">target</span> <span class="o">:</span> <span class="nx">target</span><span class="p">,</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="nx">productUrl</span><span class="p">,</span>
				<span class="nx">data</span> <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">data</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>replace with callback passed in by options</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">callback</span> <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">callback</span> <span class="o">||</span> <span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">init</span>
			<span class="p">});</span>
		<span class="p">},</span>
		<span class="nx">getAvailability</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pid</span><span class="p">,</span> <span class="nx">quantity</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">getJson</span><span class="p">({</span>
				<span class="nx">url</span><span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">getAvailability</span><span class="p">,</span> <span class="p">{</span><span class="nx">pid</span><span class="o">:</span><span class="nx">pid</span><span class="p">,</span> <span class="nx">Quantity</span><span class="o">:</span><span class="nx">quantity</span><span class="p">}),</span>
				<span class="nx">callback</span><span class="o">:</span> <span class="nx">callback</span>
			<span class="p">});</span>
		<span class="p">},</span>
		<span class="nx">initAddThis</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">addThisServices</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;compact&quot;</span><span class="p">,</span><span class="s2">&quot;facebook&quot;</span><span class="p">,</span><span class="s2">&quot;myspace&quot;</span><span class="p">,</span><span class="s2">&quot;google&quot;</span><span class="p">,</span><span class="s2">&quot;twitter&quot;</span><span class="p">],</span>
				<span class="nx">addThisToolbox</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.addthis_toolbox&quot;</span><span class="p">),</span>
				<span class="nx">addThisLinks</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
				
			<span class="kd">var</span> <span class="nx">i</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">addThisServices</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> 
			<span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">addThisToolbox</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.addthis_button_&quot;</span><span class="o">+</span><span class="nx">addThisServices</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">length</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">addThisLinks</span> <span class="o">+=</span> <span class="s1">&#39;&lt;a class=&quot;addthis_button_&#39;</span><span class="o">+</span><span class="nx">addThisServices</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;&lt;/a&gt;&#39;</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">addThisLinks</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
			
			<span class="nx">addThisToolbox</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">addThisLinks</span><span class="p">);</span>
			<span class="nx">addthis</span><span class="p">.</span><span class="nx">toolbox</span><span class="p">(</span><span class="s2">&quot;.addthis_toolbox&quot;</span><span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">initAddToCart</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">target</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.add-to-cart&quot;</span><span class="p">,</span> <span class="nx">setAddToCartHandler</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.add-to-cart&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">setAddToCartHandler</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>app.product.tile</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{};</span>

	<span class="kd">function</span> <span class="nx">initializeDom</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">tiles</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.product-tile&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">tiles</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.product-tile&quot;</span><span class="p">).</span><span class="nx">syncHeight</span><span class="p">()</span>
												<span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">idx</span><span class="p">)</span> <span class="p">{</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;idx&quot;</span><span class="p">,</span><span class="nx">idx</span><span class="p">);});</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">initializeButton</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">,</span> <span class="s2">&quot;.product-image&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.swatch-list a.swatch&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;selected&quot;</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
			
			<span class="kd">var</span> <span class="nx">tile</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.grid-tile&quot;</span><span class="p">);</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.swatch-list&quot;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.swatch.selected&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;selected&quot;</span><span class="p">);</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;selected&quot;</span><span class="p">);</span>
			<span class="nx">tile</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;a.thumb-link&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">));</span>
			<span class="nx">tile</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;a.name-link&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">));</span>
		<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;hover&quot;</span><span class="p">,</span> <span class="s2">&quot;.swatch-list a.swatch&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;selected&quot;</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
			</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>get current thumb details</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">tile</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.grid-tile&quot;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">thumb</span> <span class="o">=</span> <span class="nx">tile</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.product-image a.thumb-link img&quot;</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;:first&quot;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">swatchImg</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;:first&quot;</span><span class="p">);</span>			
			<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">swatchImg</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;thumb&quot;</span><span class="p">);</span>			
			
			<span class="kd">var</span> <span class="nx">currentAtts</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">src</span> <span class="o">:</span> <span class="nx">thumb</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">),</span>
				<span class="nx">alt</span> <span class="o">:</span> <span class="nx">thumb</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;alt&quot;</span><span class="p">),</span>
				<span class="nx">title</span> <span class="o">:</span> <span class="nx">thumb</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
			<span class="p">}</span>
			
			<span class="nx">thumb</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
				<span class="nx">src</span> <span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">src</span><span class="p">,</span>
				<span class="nx">alt</span> <span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">alt</span><span class="p">,</span>
				<span class="nx">title</span> <span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">title</span>
			<span class="p">});</span>
			
			<span class="nx">swatchImg</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;thumb&quot;</span><span class="p">,</span> <span class="nx">currentAtts</span><span class="p">);</span>			
		<span class="p">});</span>
	<span class="p">}</span>

	<span class="cm">/*************** app.product.tile public object ***************/</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">tile</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$cache</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">container</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.tiles-container&quot;</span><span class="p">)</span>
			<span class="p">};</span>
			<span class="nx">initializeEvents</span><span class="p">();</span>
			<span class="nx">initializeDom</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>app.product.compare</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{},</span>
		<span class="nx">_currentCategory</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
		<span class="nx">_isClearing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
		<span class="nx">MAX_ACTIVE</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
		<span class="nx">CI_PREFIX</span> <span class="o">=</span> <span class="s2">&quot;ci-&quot;</span><span class="p">;</span>

	<span class="cm">/************** private ****************/</span>
	<span class="kd">function</span> <span class="nx">refreshContainer</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">_isClearing</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
		
		<span class="kd">var</span> <span class="nx">ac</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">compareContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.active&quot;</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">ac</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">compareButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span> <span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">compareButton</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		</pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>update list with sequential classes for ui targeting</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">compareItems</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">compareContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.compare-item&#39;</span><span class="p">);</span>
		<span class="k">for</span><span class="p">(</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">compareItems</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">){</span>
			<span class="nx">compareItems</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;compare-item-&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">);</span>
			<span class="nx">$</span><span class="p">(</span><span class="nx">compareItems</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;compare-item-&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">);</span>
		<span class="p">}</span>
		
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">compareContainer</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="nx">ac</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
		
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">addToList</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>get the first compare-item not currently active</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">compareContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.compare-item&quot;</span><span class="p">).</span><span class="nx">not</span><span class="p">(</span><span class="s2">&quot;.active&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">();</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span> <span class="c1">// safety only</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>if already added somehow, return</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="nx">CI_PREFIX</span><span class="o">+</span><span class="nx">data</span><span class="p">.</span><span class="nx">uuid</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>set as active item</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">item</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">)</span>
			<span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nx">CI_PREFIX</span><span class="o">+</span><span class="nx">data</span><span class="p">.</span><span class="nx">uuid</span><span class="p">)</span>
			<span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;itemid&quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">itemid</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>replace the item image</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">itemImg</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;img.compareproduct&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">();</span>
		<span class="nx">itemImg</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span><span class="nx">src</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">img</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">),</span> <span class="nx">alt</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">img</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;alt&quot;</span><span class="p">)});</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>refresh container state</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">refreshContainer</span><span class="p">();</span>

		<span class="kd">var</span> <span class="nx">tile</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="nx">data</span><span class="p">.</span><span class="nx">uuid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">tile</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>ensure that the associated checkbox is checked</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">tile</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.compare-check&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">removeFromList</span><span class="p">(</span><span class="nx">uuid</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="nx">CI_PREFIX</span><span class="o">+</span><span class="nx">uuid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>replace the item image</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">itemImg</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;img.compareproduct&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">();</span>
		<span class="nx">itemImg</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span><span class="nx">src</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">compareEmptyImage</span><span class="p">,</span> <span class="nx">alt</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">EMPTY_IMG_ALT</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>remove class, data and id from item</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">item</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">)</span>
			<span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
			<span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;data-itemid&quot;</span><span class="p">)</span>
			<span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;itemid&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>use clone to prevent image flash when removing item from list</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">cloneItem</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
		<span class="nx">item</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
		<span class="nx">cloneItem</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">comparePanel</span><span class="p">);</span>
		<span class="nx">refreshContainer</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>ensure that the associated checkbox is not checked</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">tile</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="nx">uuid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">tile</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>

		<span class="nx">tile</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.compare-check&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeCache</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span> <span class="o">=</span> <span class="p">{</span>
			<span class="nx">primaryContent</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#primary&quot;</span><span class="p">),</span>
			<span class="nx">compareContainer</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#compare-items&quot;</span><span class="p">),</span>
			<span class="nx">compareButton</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#compare-items-button&quot;</span><span class="p">),</span>
			<span class="nx">clearButton</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#clear-compared-items&quot;</span><span class="p">),</span>
			<span class="nx">comparePanel</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#compare-items-panel&quot;</span><span class="p">)</span>
		<span class="p">};</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeDom</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">_currentCategory</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">compareContainer</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">active</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">compareContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.compare-item&quot;</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;.active&quot;</span><span class="p">);</span>
		<span class="nx">active</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">uuid</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">CI_PREFIX</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">tile</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="nx">uuid</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">tile</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>

			<span class="nx">tile</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.compare-check&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>set container state</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">refreshContainer</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>add event to buttons to remove products</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">primaryContent</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.compare-item-remove&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">async</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.compare-item&quot;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">uuid</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">CI_PREFIX</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">tile</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="nx">uuid</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">itemid</span> <span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;itemid&quot;</span><span class="p">),</span>
				<span class="nx">uuid</span> <span class="o">:</span> <span class="nx">uuid</span><span class="p">,</span>
				<span class="nx">cb</span> <span class="o">:</span>  <span class="nx">tile</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nx">tile</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.compare-check&quot;</span><span class="p">),</span>
				<span class="nx">async</span> <span class="o">:</span> <span class="nx">async</span>
			<span class="p">};</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">compare</span><span class="p">.</span><span class="nx">removeProduct</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
			<span class="nx">refreshContainer</span><span class="p">();</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Button to go to compare page</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">primaryContent</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;#compare-items-button&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamToURL</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">compareShow</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="nx">_currentCategory</span><span class="p">);</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Button to clear all compared items</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">primaryContent</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;#clear-compared-items&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">_isClearing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">compareContainer</span><span class="p">.</span><span class="nx">hide</span><span class="p">()</span>
								   <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.active .compare-item-remove&quot;</span><span class="p">)</span>
								   <span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="p">[</span><span class="kc">false</span><span class="p">]);</span>
			<span class="nx">_isClearing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

		<span class="p">});</span>
	<span class="p">}</span>

	<span class="cm">/*************** app.product.compare public object ***************/</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">compare</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">initializeCache</span><span class="p">();</span>
			<span class="nx">initializeDom</span><span class="p">();</span>
			<span class="nx">initializeEvents</span><span class="p">();</span>
		<span class="p">},</span>
		<span class="nx">initCache</span> <span class="o">:</span> <span class="nx">initializeCache</span><span class="p">,</span>
		<span class="nx">addProduct</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">compareContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.compare-item&quot;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">cb</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">cb</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">ac</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;.active&quot;</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">ac</span><span class="o">===</span><span class="nx">MAX_ACTIVE</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">confirm</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">COMPARE_CONFIRMATION</span><span class="p">))</span> <span class="p">{</span>
					<span class="nx">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
					<span class="k">return</span><span class="p">;</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>remove product using id</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">first</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>safety check only. should never occur.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">CI_PREFIX</span><span class="p">)</span><span class="o">!==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
					<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">COMPARE_ADD_FAIL</span><span class="p">);</span>
					<span class="k">return</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="kd">var</span> <span class="nx">uuid</span> <span class="o">=</span> <span class="nx">item</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">CI_PREFIX</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">compare</span><span class="p">.</span><span class="nx">removeProduct</span><span class="p">({</span>
					<span class="nx">itemid</span><span class="o">:</span> <span class="nx">item</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;itemid&quot;</span><span class="p">),</span>
					<span class="nx">uuid</span><span class="o">:</span> <span class="nx">uuid</span><span class="p">,</span>
					<span class="nx">cb</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="nx">uuid</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.compare-check&quot;</span><span class="p">)</span>
				<span class="p">});</span>
			<span class="p">}</span>

			<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">getJson</span><span class="p">({</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">compareAdd</span><span class="p">,</span>
				<span class="nx">data</span> <span class="o">:</span> <span class="p">{</span> <span class="s1">&#39;pid&#39;</span> <span class="o">:</span> <span class="nx">args</span><span class="p">.</span><span class="nx">itemid</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span> <span class="o">:</span> <span class="nx">_currentCategory</span> <span class="p">},</span>
				<span class="nx">callback</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span> <span class="o">||</span> <span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>response failed. uncheck the checkbox return</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="nx">cb</span><span class="p">.</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
						<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">COMPARE_ADD_FAIL</span><span class="p">);</span>
						<span class="k">return</span><span class="p">;</span>
					<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>item successfully stored in session, now add to list...</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">addToList</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">});</span>
		<span class="p">},</span>

		<span class="nx">removeProduct</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">args</span><span class="p">.</span><span class="nx">itemid</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
			<span class="kd">var</span> <span class="nx">cb</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">cb</span> <span class="o">?</span> <span class="nx">$</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">cb</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">getJson</span><span class="p">({</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">compareRemove</span><span class="p">,</span>
				<span class="nx">data</span> <span class="o">:</span> <span class="p">{</span> <span class="s1">&#39;pid&#39;</span> <span class="o">:</span> <span class="nx">args</span><span class="p">.</span><span class="nx">itemid</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span> <span class="o">:</span> <span class="nx">_currentCategory</span> <span class="p">},</span>
				<span class="nx">async</span><span class="o">:</span> <span class="nx">args</span><span class="p">.</span><span class="nx">async</span><span class="p">,</span>
				<span class="nx">callback</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span> <span class="o">||</span> <span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>response failed. uncheck the checkbox return</p>             </td>             <td class="code">               <div class="highlight"><pre>						<span class="k">if</span> <span class="p">(</span><span class="nx">cb</span> <span class="o">&amp;&amp;</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
						<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">COMPARE_REMOVE_FAIL</span><span class="p">);</span>
						<span class="k">return</span><span class="p">;</span>
					<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>item successfully removed session, now remove from to list...</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">removeFromList</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">uuid</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>app.compare</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{};</span>

	<span class="kd">function</span> <span class="nx">initializeCache</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span> <span class="o">=</span> <span class="p">{</span>
			<span class="nx">compareTable</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#compare-table&quot;</span><span class="p">),</span>
			<span class="nx">categoryList</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#compare-category-list&quot;</span><span class="p">)</span>
		<span class="p">};</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeDom</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">compareTable</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.remove-link&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">getJson</span><span class="p">({</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
				<span class="nx">callback</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
				<span class="p">}</span>
			<span class="p">});</span>
		<span class="p">})</span>
		<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.open-quick-view&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">);</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span>
				<span class="nx">url</span><span class="o">:</span><span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">),</span>
				<span class="nx">source</span><span class="o">:</span><span class="s2">&quot;quickview&quot;</span><span class="p">,</span>
				<span class="nx">data</span><span class="o">:</span><span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span>
			<span class="p">});</span>
		<span class="p">});</span>

		<span class="nx">$cache</span><span class="p">.</span><span class="nx">categoryList</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">();</span>
		<span class="p">});</span>
	<span class="p">}</span>

	<span class="cm">/*************** app.compare public object ***************/</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">compare</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">initializeCache</span><span class="p">();</span>
			<span class="nx">initializeDom</span><span class="p">();</span>
			<span class="nx">initializeEvents</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">initAddToCart</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">};</span>


<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>send to friend</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{},</span>
		<span class="nx">initialized</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span>
	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">limitCharacters</span><span class="p">();</span>		
		<span class="k">if</span> <span class="p">(</span><span class="nx">initialized</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span><span class="p">;</span> <span class="p">}</span>			
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.preview-button, .send-button, .edit-button&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">validate</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">valid</span><span class="p">())</span> <span class="p">{</span>
				<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="kd">var</span> <span class="nx">requestType</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;#request-type&quot;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">requestType</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">requestType</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
			<span class="p">}</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;input/&gt;&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="s2">&quot;request-type&quot;</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span><span class="s2">&quot;hidden&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span> <span class="nx">value</span><span class="o">:</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)}).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">form</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">),</span>
				   <span class="nx">data</span><span class="o">:</span> <span class="nx">data</span><span class="p">,</span>
				   <span class="nx">target</span><span class="o">:</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">dialog</span><span class="p">,</span>
				   <span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">limitCharacters</span><span class="p">();</span>
						<span class="nx">$cache</span><span class="p">.</span><span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#send-to-friend-form&quot;</span><span class="p">);</span>
						<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.ui-dialog-content&quot;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s2">&quot;option&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;center&quot;</span><span class="p">);</span>													
				   <span class="p">}</span>
			<span class="p">});</span>
		<span class="p">})</span>
		<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.cancel-button, .close-button&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">);</span>
		<span class="p">});</span>
		<span class="nx">initialized</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/*************** app.sendToFriend public object ***************/</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">sendToFriend</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$cache</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">form</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#send-to-friend-form&quot;</span><span class="p">),</span>
				<span class="nx">dialog</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#send-to-friend-dialog&quot;</span><span class="p">),</span>
				<span class="nx">pdpForm</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;form.pdpForm&quot;</span><span class="p">)</span>
			<span class="p">};</span>			
			<span class="nx">initializeEvents</span><span class="p">();</span>
		<span class="p">},</span>
		<span class="nx">initializeDialog</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">eventDelegate</span><span class="p">,</span> <span class="nx">eventTarget</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">(</span><span class="nx">eventDelegate</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">eventTarget</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">dlg</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="nx">target</span><span class="o">:</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#send-to-friend-dialog&quot;</span><span class="p">),</span> <span class="nx">options</span><span class="o">:</span><span class="p">{</span>
					<span class="nx">width</span><span class="o">:</span><span class="mi">800</span><span class="p">,</span>
					<span class="nx">height</span><span class="o">:</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
					<span class="nx">title</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
					<span class="nx">open</span><span class="o">:</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">sendToFriend</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
					<span class="p">}</span>
				<span class="p">}});</span>

				<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getQueryStringParams</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;form.pdpForm&quot;</span><span class="p">).</span><span class="nx">serialize</span><span class="p">());</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">cartAction</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">delete</span> <span class="nx">data</span><span class="p">.</span><span class="nx">cartAction</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
				<span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">protocol</span> <span class="o">+</span> <span class="s2">&quot;//&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">hostname</span> <span class="o">+</span> <span class="p">((</span><span class="nx">url</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">===</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">url</span> <span class="o">:</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nx">url</span><span class="p">));</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span>
					<span class="nx">url</span><span class="o">:</span><span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">ajaxUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">),</span>
					<span class="nx">target</span><span class="o">:</span><span class="nx">dlg</span><span class="p">,</span>
					<span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
						<span class="nx">dlg</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>	 <span class="c1">// open after load to ensure dialog is centered</span>
					<span class="p">}</span>
				<span class="p">});</span>
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>app.search</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{};</span>

	<span class="cm">/**</span>
<span class="cm">	 *  replaces breadcrumbs, lefthand nav and product listing with ajax and puts a loading indicator over the product listing</span>
<span class="cm">	 */</span>
	<span class="kd">function</span> <span class="nx">updateProductListing</span><span class="p">(</span><span class="nx">isHashChange</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">hash</span><span class="o">===</span><span class="s1">&#39;#results-content&#39;</span> <span class="o">||</span> <span class="nx">hash</span><span class="o">===</span><span class="s1">&#39;#results-products&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>

		<span class="kd">var</span> <span class="nx">refineUrl</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">hash</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">refineUrl</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">pathname</span><span class="o">+</span><span class="s2">&quot;?&quot;</span><span class="o">+</span><span class="nx">hash</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isHashChange</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">refineUrl</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">refineUrl</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>

		<span class="nx">app</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">content</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamToURL</span><span class="p">(</span><span class="nx">refineUrl</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;ajax&quot;</span><span class="p">),</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">compare</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>

		<span class="p">});</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>compare checked</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;input[type=&#39;checkbox&#39;].compare-check&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">cb</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">tile</span> <span class="o">=</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.product-tile&quot;</span><span class="p">);</span>

			<span class="kd">var</span> <span class="nx">func</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">checked</span> <span class="o">?</span> <span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">compare</span><span class="p">.</span><span class="nx">addProduct</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">compare</span><span class="p">.</span><span class="nx">removeProduct</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">itemImg</span> <span class="o">=</span> <span class="nx">tile</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;div.product-image a img&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">();</span>
			<span class="nx">func</span><span class="p">({</span>
				<span class="nx">itemid</span> <span class="o">:</span> <span class="nx">tile</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;itemid&quot;</span><span class="p">),</span>
				<span class="nx">uuid</span> <span class="o">:</span> <span class="nx">tile</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">,</span>
				<span class="nx">img</span> <span class="o">:</span> <span class="nx">itemImg</span>
			<span class="p">});</span>

		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>handle toggle refinement blocks</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.refinement h3&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
		 	<span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s1">&#39;expanded&#39;</span><span class="p">)</span>
		 	<span class="p">.</span><span class="nx">siblings</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
		<span class="p">});</span>
		</pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>handle events for updating grid</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.refinements a, .pagination a, .breadcrumb-refinement-value a&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;unselectable&quot;</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
			<span class="kd">var</span> <span class="nx">uri</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getUri</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

			<span class="kd">var</span> <span class="nx">refineUrl</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
			<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nb">encodeURI</span><span class="p">(</span><span class="nx">refineUrl</span><span class="p">);</span>
			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>handle events item click. append params.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.product-tile a:not(&#39;#quickviewbutton&#39;)&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>get current page refinement values</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">wl</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">;</span>

			<span class="kd">var</span> <span class="nx">qsParams</span> <span class="o">=</span> <span class="p">(</span><span class="nx">wl</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getQueryStringParams</span><span class="p">(</span><span class="nx">wl</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">:</span> <span class="p">{};</span>
			<span class="kd">var</span> <span class="nx">hashParams</span> <span class="o">=</span> <span class="p">(</span><span class="nx">wl</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getQueryStringParams</span><span class="p">(</span><span class="nx">wl</span><span class="p">.</span><span class="nx">hash</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">:</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>merge hash params with querystring params</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">hashParams</span><span class="p">,</span> <span class="nx">qsParams</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">params</span><span class="p">.</span><span class="nx">start</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">params</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>get the index of the selected item and save as start parameter</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">tile</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.product-tile&quot;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="nx">tile</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;idx&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="o">+</span><span class="nx">tile</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;idx&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>convert params.start to integer and add index</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">params</span><span class="p">.</span><span class="nx">start</span><span class="o">=</span><span class="p">(</span><span class="o">+</span><span class="nx">params</span><span class="p">.</span><span class="nx">start</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nx">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>set the hash and allow normal action to continue</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">hash</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>handle sorting change</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="s2">&quot;.sort-by select&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">refineUrl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;option:selected&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">uri</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getUri</span><span class="p">(</span><span class="nx">refineUrl</span><span class="p">);</span>
			<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">})</span>
		<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="s2">&quot;.items-per-page select&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">refineUrl</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;option:selected&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">uri</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getUri</span><span class="p">(</span><span class="nx">refineUrl</span><span class="p">);</span>
			<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>handle hash change</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">hashchange</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">updateProductListing</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
		<span class="p">});</span>
	<span class="p">}</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">search</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$cache</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">main</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#main&quot;</span><span class="p">),</span>
				<span class="nx">items</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#search-result-items&quot;</span><span class="p">)</span>
			<span class="p">};</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.search-result-content&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>if (app.product.compare) {</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">compare</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>}</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">updateProductListing</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">tile</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="nx">initializeEvents</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>app.bonusProductsView</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="kd">var</span> <span class="nx">selectedList</span> <span class="o">=</span> <span class="p">[];</span>
	<span class="kd">var</span> <span class="nx">maxItems</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">bliUUID</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

	<span class="kd">function</span> <span class="nx">getBonusProducts</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="p">{};</span>
		<span class="nx">o</span><span class="p">.</span><span class="nx">bonusproducts</span> <span class="o">=</span> <span class="p">[];</span>

		<span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">len</span><span class="o">=</span><span class="nx">selectedList</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">pid</span> <span class="o">:</span> <span class="nx">selectedList</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">pid</span><span class="p">,</span>	<span class="nx">qty</span> <span class="o">:</span> <span class="nx">selectedList</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">qty</span><span class="p">,</span> <span class="nx">options</span> <span class="o">:</span> <span class="p">{}</span> <span class="p">};</span>
			<span class="kd">var</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">alen</span><span class="p">,</span> <span class="nx">bp</span><span class="o">=</span><span class="nx">selectedList</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
			<span class="k">for</span> <span class="p">(</span><span class="nx">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">alen</span><span class="o">=</span><span class="nx">bp</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">a</span><span class="o">&lt;</span><span class="nx">alen</span><span class="p">;</span><span class="nx">a</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">opt</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">a</span><span class="p">];</span>
				<span class="nx">p</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="p">{</span><span class="nx">optionName</span><span class="o">:</span><span class="nx">opt</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="nx">optionValue</span><span class="o">:</span><span class="nx">opt</span><span class="p">.</span><span class="nx">value</span><span class="p">};</span>
			<span class="p">}</span>
			<span class="nx">o</span><span class="p">.</span><span class="nx">bonusproducts</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">product</span><span class="o">:</span><span class="nx">p</span><span class="p">});</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nx">o</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">updateSummary</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">selectedList</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProductList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;li.selected-bonus-item&quot;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">ulList</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProductList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;ul.selected-bonus-items&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">itemTemplate</span> <span class="o">=</span> <span class="nx">ulList</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.selected-item-template&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">len</span><span class="o">=</span><span class="nx">selectedList</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">selectedList</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
				<span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nx">itemTemplate</span><span class="p">.</span><span class="nx">clone</span><span class="p">().</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;selected-item-template&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;selected-bonus-item&quot;</span><span class="p">);</span>
				<span class="nx">li</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">uuid</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;pid&quot;</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">pid</span><span class="p">);</span> 
				<span class="nx">li</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.item-name&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
				<span class="nx">li</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.item-qty&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">qty</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">ulAtts</span> <span class="o">=</span> <span class="nx">li</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.item-attributes&quot;</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">attTemplate</span> <span class="o">=</span> <span class="nx">ulAtts</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">first</span><span class="p">().</span><span class="nx">clone</span><span class="p">();</span>
				<span class="nx">ulAtts</span><span class="p">.</span><span class="nx">empty</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">att</span><span class="p">;</span>
				<span class="k">for</span> <span class="p">(</span><span class="nx">att</span> <span class="k">in</span> <span class="nx">item</span><span class="p">.</span><span class="nx">attributes</span><span class="p">)</span> <span class="p">{</span>
					<span class="kd">var</span> <span class="nx">attLi</span> <span class="o">=</span> <span class="nx">attTemplate</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
					<span class="nx">attLi</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">att</span><span class="p">);</span>
					<span class="nx">attLi</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.display-name&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">att</span><span class="p">].</span><span class="nx">displayName</span><span class="p">);</span>
					<span class="nx">attLi</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.display-value&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">att</span><span class="p">].</span><span class="nx">displayValue</span><span class="p">);</span>
					<span class="nx">attLi</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">ulAtts</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="nx">li</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">ulList</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="nx">ulList</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.selected-bonus-item&quot;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
		<span class="p">}</span>
		</pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>get remaining item count</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">remain</span> <span class="o">=</span> <span class="nx">maxItems</span> <span class="o">-</span> <span class="nx">selectedList</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProductList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.bonus-items-available&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="nx">remain</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">remain</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProductList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;button.button-select-bonus&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span> <span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProductList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;button.button-select-bonus&quot;</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="cm">/********* public app.bonusProductsView object *********/</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">bonusProductsView</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$cache</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">bonusProduct</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#bonus-product-dialog&quot;</span><span class="p">),</span>
				<span class="nx">resultArea</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#product-result-area&quot;</span><span class="p">)</span>
			<span class="p">};</span>
		<span class="p">},</span>
		<span class="nx">show</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>add element to cache if it does not already exist</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProduct</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">bonusProductsView</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>create the dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProduct</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
				<span class="nx">target</span> <span class="o">:</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProduct</span><span class="p">,</span>
				<span class="nx">options</span> <span class="o">:</span> <span class="p">{</span>
					<span class="nx">width</span><span class="o">:</span> <span class="mi">795</span><span class="p">,</span>
					<span class="nx">dialogClass</span> <span class="o">:</span> <span class="s1">&#39;quickview&#39;</span><span class="p">,</span>
					<span class="nx">title</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">BONUS_PRODUCTS</span>
				<span class="p">}</span>
			<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>load the products then show</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span>
				<span class="nx">target</span> <span class="o">:</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProduct</span><span class="p">,</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
				<span class="nx">callback</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProduct</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">);</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">bonusProductsView</span><span class="p">.</span><span class="nx">initializeGrid</span><span class="p">();</span>
				<span class="p">}</span>
			<span class="p">});</span>

		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>close the quick view dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">close</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProduct</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">loadBonusOption</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusDiscountContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.bonus-discount-container&quot;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusDiscountContainer</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>

			<span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
				<span class="nx">target</span> <span class="o">:</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusDiscountContainer</span><span class="p">,</span>
				<span class="nx">options</span> <span class="o">:</span> <span class="p">{</span>
					<span class="nx">height</span> <span class="o">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
					<span class="nx">width</span> <span class="o">:</span> <span class="mi">350</span><span class="p">,</span>
					<span class="nx">dialogClass</span> <span class="o">:</span> <span class="s1">&#39;quickview&#39;</span><span class="p">,</span>
					<span class="nx">title</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">BONUS_PRODUCT</span>
				<span class="p">}</span>
			<span class="p">});</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusDiscountContainer</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>add event handlers</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusDiscountContainer</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.select-bonus-btn&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">uuid</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusDiscountContainer</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;lineitemid&quot;</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">getBonusProducts</span><span class="p">,</span>
													 <span class="p">{</span>
														<span class="nx">bonusDiscountLineItemUUID</span> <span class="o">:</span> <span class="nx">uuid</span><span class="p">,</span>
														<span class="nx">source</span> <span class="o">:</span> <span class="s2">&quot;bonus&quot;</span>
													 <span class="p">});</span>

				<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusDiscountContainer</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">bonusProductsView</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
			<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.no-bonus-btn&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusDiscountContainer</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span>
			<span class="p">});</span>
		<span class="p">},</span>
		<span class="nx">initializeGrid</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProductList</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#bonus-product-list&quot;</span><span class="p">),</span>
				<span class="nx">bliData</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProductList</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;line-item-detail&quot;</span><span class="p">);</span>

			<span class="nx">maxItems</span> <span class="o">=</span> <span class="nx">bliData</span><span class="p">.</span><span class="nx">maxItems</span><span class="p">;</span>
			<span class="nx">bliUUID</span> <span class="o">=</span> <span class="nx">bliData</span><span class="p">.</span><span class="nx">uuid</span><span class="p">;</span>
			
			<span class="k">if</span> <span class="p">(</span><span class="nx">bliData</span><span class="p">.</span><span class="nx">itemCount</span><span class="o">&gt;=</span><span class="nx">maxItems</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProductList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;button.button-select-bonus&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span> <span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			
			<span class="kd">var</span> <span class="nx">cartItems</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProductList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.selected-bonus-item&quot;</span><span class="p">);</span>
			
			<span class="nx">cartItems</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">ci</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
				
				<span class="kd">var</span> <span class="nx">product</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">uuid</span> <span class="o">:</span> <span class="nx">ci</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">),</span>
					<span class="nx">pid</span> <span class="o">:</span> <span class="nx">ci</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;pid&quot;</span><span class="p">),</span>
					<span class="nx">qty</span> <span class="o">:</span> <span class="nx">ci</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.item-qty&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(),</span>
					<span class="nx">name</span> <span class="o">:</span> <span class="nx">ci</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.item-name&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(),</span>
					<span class="nx">attributes</span><span class="o">:</span> <span class="p">{}</span>
				<span class="p">};</span>
				<span class="kd">var</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="nx">ci</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;ul.item-attributes li&quot;</span><span class="p">);</span>
				<span class="nx">attributes</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
					<span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
					<span class="nx">product</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">li</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;attributeId&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
						<span class="nx">displayName</span><span class="o">:</span><span class="nx">li</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.display-name&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(),</span>
						<span class="nx">displayValue</span><span class="o">:</span><span class="nx">li</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.display-value&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">()</span>
					<span class="p">};</span>
				<span class="p">});</span>
				<span class="nx">selectedList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">product</span><span class="p">);</span>
			<span class="p">});</span>

	
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProductList</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;div.bonus-product-item a[href].swatchanchor&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

				<span class="kd">var</span> <span class="nx">anchor</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
					<span class="nx">bpItem</span> <span class="o">=</span> <span class="nx">anchor</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.bonus-product-item&quot;</span><span class="p">),</span>
					<span class="nx">bpForm</span> <span class="o">=</span> <span class="nx">bpItem</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;form.bonus-product-form&quot;</span><span class="p">),</span>
					<span class="nx">qty</span> <span class="o">=</span> <span class="nx">bpForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;Quantity&#39;]&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">val</span><span class="p">(),</span>
					<span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
						<span class="nx">Quantity</span> <span class="o">:</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">qty</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;1&quot;</span> <span class="o">:</span> <span class="nx">qty</span><span class="p">,</span>
						<span class="nx">format</span> <span class="o">:</span> <span class="s2">&quot;ajax&quot;</span><span class="p">,</span>
						<span class="nx">source</span> <span class="o">:</span> <span class="s2">&quot;bonus&quot;</span><span class="p">,</span>
						<span class="nx">bonusDiscountLineItemUUID</span> <span class="o">:</span> <span class="nx">bliUUID</span>
					<span class="p">};</span>

				<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>

				<span class="nx">app</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">bpItem</span><span class="p">);</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span>
					<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
					<span class="nx">callback</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">bpItem</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">});</span>
			<span class="p">})</span>
			<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;button.button-select-bonus&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">selectedList</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;=</span><span class="nx">maxItems</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProductList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;button.button-select-bonus&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span> <span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProductList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;bonus-items-available&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">);</span>
					<span class="k">return</span><span class="p">;</span>
				<span class="p">}</span>

				<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;form.bonus-product-form&quot;</span><span class="p">),</span>
					<span class="nx">detail</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.product-detail&quot;</span><span class="p">);</span>
					<span class="nx">uuid</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;productUUID&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
					<span class="nx">qtyVal</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;Quantity&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
					<span class="nx">qty</span> <span class="o">=</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">qtyVal</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="p">(</span><span class="o">+</span><span class="nx">qtyVal</span><span class="p">);</span>

				<span class="kd">var</span> <span class="nx">product</span> <span class="o">=</span> <span class="p">{</span>
					<span class="nx">uuid</span> <span class="o">:</span> <span class="nx">uuid</span><span class="p">,</span>
					<span class="nx">pid</span> <span class="o">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;pid&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
					<span class="nx">qty</span> <span class="o">:</span> <span class="nx">qty</span><span class="p">,</span>
					<span class="nx">name</span> <span class="o">:</span> <span class="nx">detail</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.product-name&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">(),</span>
					<span class="nx">attributes</span> <span class="o">:</span> <span class="nx">detail</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.product-variations&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;current&quot;</span><span class="p">),</span>
					<span class="nx">options</span> <span class="o">:</span> <span class="p">[]</span>
				<span class="p">};</span>

				<span class="kd">var</span> <span class="nx">optionSelects</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select.product-option&quot;</span><span class="p">);</span>

				<span class="nx">optionSelects</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">product</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
						<span class="nx">name</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
						<span class="nx">value</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span>
						<span class="nx">display</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;:selected&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">html</span><span class="p">()</span>
					<span class="p">});</span>
				<span class="p">});</span>
				<span class="nx">selectedList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">product</span><span class="p">);</span>
				<span class="nx">updateSummary</span><span class="p">();</span>
			<span class="p">})</span>
			<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.remove-link&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
				<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;li.selected-bonus-item&quot;</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">container</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
				
				<span class="kd">var</span> <span class="nx">uuid</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">selectedList</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
				<span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">selectedList</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">uuid</span><span class="o">===</span><span class="nx">uuid</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">selectedList</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="nx">updateSummary</span><span class="p">();</span>
			<span class="p">})</span>
			<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.add-to-cart-bonus&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">addBonusProduct</span><span class="p">,</span> <span class="p">{</span><span class="nx">bonusDiscountLineItemUUID</span><span class="o">:</span><span class="nx">bliUUID</span><span class="p">});</span>
				<span class="kd">var</span> <span class="nx">bonusProducts</span> <span class="o">=</span> <span class="nx">getBonusProducts</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>make the server call</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
					<span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
					<span class="nx">dataType</span> <span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
					<span class="nx">cache</span>	<span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
					<span class="nx">contentType</span> <span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
					<span class="nx">url</span> <span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
					<span class="nx">data</span> <span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">bonusProducts</span><span class="p">)</span>
				<span class="p">})</span>
				<span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>success</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">app</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
				<span class="p">})</span>
				<span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>failed</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">if</span><span class="p">(</span><span class="nx">textStatus</span> <span class="o">===</span> <span class="s2">&quot;parsererror&quot;</span><span class="p">)</span> <span class="p">{</span>
						<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">BAD_RESPONSE</span><span class="p">);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">SERVER_CONNECTION_ERROR</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">})</span>
				<span class="p">.</span><span class="nx">always</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">bonusProduct</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">);</span>
				<span class="p">});</span>
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>app.giftcard</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	
	<span class="nx">app</span><span class="p">.</span><span class="nx">giftcard</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">checkBalance</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>load gift certificate details</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamToURL</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">giftCardCheckBalance</span><span class="p">,</span> <span class="s2">&quot;giftCertificateID&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="p">);</span>

			<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">getJson</span><span class="p">({</span>
				<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
				<span class="nx">callback</span><span class="o">:</span> <span class="nx">callback</span>
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>app.checkout</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{},</span>
		<span class="nx">isShipping</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
		<span class="nx">shippingMethods</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Helper method which constructs a URL for an AJAX request using the</span>
<span class="cm">	 * entered address information as URL request parameters.</span>
<span class="cm">	 */</span>
	<span class="kd">function</span> <span class="nx">getShippingMethodURL</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">newUrl</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> 
												<span class="p">{</span>
													<span class="nx">countryCode</span><span class="o">:</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">countryCode</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
												 	<span class="nx">stateCode</span><span class="o">:</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">stateCode</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
												 	<span class="nx">postalCode</span><span class="o">:</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">postalCode</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
												 	<span class="nx">city</span><span class="o">:</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">city</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
												 <span class="p">},</span>
												 <span class="kc">true</span><span class="p">);</span>
		<span class="k">return</span> <span class="nx">newUrl</span><span class="p">;</span>
	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>updates the order summary based on a possibly recalculated
basket after a shipping promotion has been applied</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">function</span> <span class="nx">updateSummary</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">summaryRefreshURL</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">summary</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#secondary.summary&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>indicate progress</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">app</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">summary</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>load the updated summary area</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">summary</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span> <span class="nx">url</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>hide edit shipping method link</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">summary</span><span class="p">.</span><span class="nx">fadeIn</span><span class="p">(</span><span class="s2">&quot;fast&quot;</span><span class="p">);</span>
			<span class="nx">summary</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.checkout-mini-cart .minishipment .header a&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
			<span class="nx">summary</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.order-totals-table .order-shipping .label a&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
		<span class="p">});</span>
	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>selects a shipping method for the default shipment
and updates the summary section on the right hand side</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">function</span> <span class="nx">selectShippingMethod</span><span class="p">(</span><span class="nx">shippingMethodID</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>nothing entered</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">shippingMethodID</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>attempt to set shipping method</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">selectShippingMethodsList</span><span class="p">,</span>
											 <span class="p">{</span> <span class="nx">countryCode</span><span class="o">:</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">countryCode</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
											   <span class="nx">stateCode</span><span class="o">:</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">stateCode</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
											   <span class="nx">postalCode</span><span class="o">:</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">postalCode</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
											   <span class="nx">city</span><span class="o">:</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">city</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span>
											   <span class="nx">shippingMethodID</span><span class="o">:</span><span class="nx">shippingMethodID</span>
											 <span class="p">},</span>
											 <span class="kc">true</span><span class="p">);</span>

		 <span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">getJson</span><span class="p">({</span>
			<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
			<span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">updateSummary</span><span class="p">();</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">data</span> <span class="o">||</span> <span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">shippingMethodID</span><span class="p">)</span> <span class="p">{</span>
					<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t select shipping method.&quot;</span><span class="p">);</span>
					<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>display promotion in UI and update the summary section,
if some promotions were applied</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.shippingpromotions&quot;</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">shippingPriceAdjustments</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">shippingPriceAdjustments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="kd">var</span> <span class="nx">i</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">data</span><span class="p">.</span><span class="nx">shippingPriceAdjustments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
					<span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
						<span class="kd">var</span> <span class="nx">spa</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">shippingPriceAdjustments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">});</span>
	<span class="p">}</span>

	<span class="cm">/**</span>
<span class="cm">	 * Make an AJAX request to the server to retrieve the list of applicable shipping methods</span>
<span class="cm">	 * based on the merchandise in the cart and the currently entered shipping address</span>
<span class="cm">	 * (the address may be only partially entered).  If the list of applicable shipping methods</span>
<span class="cm">	 * has changed because new address information has been entered, then issue another AJAX</span>
<span class="cm">	 * request which updates the currently selected shipping method (if needed) and also updates</span>
<span class="cm">	 * the UI.</span>
<span class="cm">	 */</span>
	<span class="kd">function</span> <span class="nx">updateShippingMethodList</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">shippingMethodList</span> <span class="o">||</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">shippingMethodList</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
		<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">getShippingMethodURL</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">shippingMethodsJSON</span><span class="p">);</span>

		 <span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">getJson</span><span class="p">({</span>
			<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
			<span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
					<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t get list of applicable shipping methods.&quot;</span><span class="p">);</span>
					<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">shippingMethods</span> <span class="o">&amp;&amp;</span> <span class="nx">shippingMethods</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">===</span> <span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
				<span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>No need to update the UI.  The list has not changed.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>We need to update the UI.  The list has changed.
Cache the array of returned shipping methods.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">shippingMethods</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>

				<span class="kd">var</span> <span class="nx">smlUrl</span> <span class="o">=</span> <span class="nx">getShippingMethodURL</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">shippingMethodsList</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>indicate progress</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">app</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">shippingMethodList</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>load the shipping method form</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$cache</span><span class="p">.</span><span class="nx">shippingMethodList</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span> <span class="nx">smlUrl</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">shippingMethodList</span><span class="p">.</span><span class="nx">fadeIn</span><span class="p">(</span><span class="s2">&quot;fast&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>rebind the radio buttons onclick function to a handler.</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">$cache</span><span class="p">.</span><span class="nx">shippingMethodList</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_shippingMethodID&#39;]&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
						<span class="nx">selectShippingMethod</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
					<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>update the summary</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">updateSummary</span><span class="p">();</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">tooltips</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
				<span class="p">});</span>
			<span class="p">}</span>
		<span class="p">});</span>
	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <p>shipping page logic
checkout gift message counter</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">function</span> <span class="nx">initGiftMessageBox</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>show gift message box, if shipment is gift</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">giftMessage</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;#is-gift-yes&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span><span class="p">);</span>

	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">shippingLoad</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;#is-gift-yes, #is-gift-no&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.gift-message-text&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;#is-gift-yes&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span><span class="p">);</span>
		<span class="p">})</span>
		<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span>
			<span class="s2">&quot;input[name$=&#39;_addressFields_state&#39;], input[name$=&#39;_addressFields_city&#39;], input[name$=&#39;_addressFields_zip&#39;]&quot;</span><span class="p">,</span>
			<span class="nx">updateShippingMethodList</span>
		<span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>gift message character limitation</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">initGiftMessageBox</span><span class="p">();</span>
		<span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
	<span class="p">}</span>	

	<span class="kd">function</span> <span class="nx">addressLoad</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>select address from list</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressList</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">selected</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;:selected&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">selected</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
			<span class="kd">var</span> <span class="nx">p</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="nx">p</span> <span class="k">in</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="nx">p</span><span class="p">])</span> <span class="p">{</span>
					<span class="nx">$cache</span><span class="p">[</span><span class="nx">p</span><span class="p">].</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">p</span><span class="p">].</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <p>special handling for countrycode => stateCode combo</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="k">if</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span><span class="o">===</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">countryCode</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">updateStateOptions</span><span class="p">(</span><span class="nx">$cache</span><span class="p">[</span><span class="nx">p</span><span class="p">]);</span>
						<span class="nx">$cache</span><span class="p">.</span><span class="nx">stateCode</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">stateCode</span><span class="p">);</span>
						<span class="nx">$cache</span><span class="p">.</span><span class="nx">stateCode</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="nx">updateShippingMethodList</span><span class="p">();</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>re-validate the form</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">validate</span><span class="p">().</span><span class="nx">form</span><span class="p">();</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>update state options in case the country changes</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">countryCode</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">updateStateOptions</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
		<span class="p">});</span>
	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <p>changes the payment method form</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">function</span> <span class="nx">changePaymentMethod</span><span class="p">(</span><span class="nx">paymentMethodID</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">paymentMethods</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;payment-method-expanded&quot;</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">pmc</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">paymentMethods</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;#PaymentMethod_&quot;</span><span class="o">+</span><span class="nx">paymentMethodID</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">pmc</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">pmc</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#PaymentMethod_Custom&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nx">pmc</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;payment-method-expanded&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>ensure checkbox of payment method is checked</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#is-&quot;</span> <span class="o">+</span> <span class="nx">paymentMethodID</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		
		<span class="kd">var</span> <span class="nx">bmlForm</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;#PaymentMethod_BML&quot;</span><span class="p">);</span>
		<span class="nx">bmlForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select[name$=&#39;_year&#39;]&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">);</span>
		<span class="nx">bmlForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select[name$=&#39;_month&#39;]&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">);</span>
		<span class="nx">bmlForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select[name$=&#39;_day&#39;]&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">);</span>
		<span class="nx">bmlForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_ssn&#39;]&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">);</span>
		
		<span class="k">if</span> <span class="p">(</span><span class="nx">paymentMethodID</span><span class="o">===</span><span class="s2">&quot;BML&quot;</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">yr</span> <span class="o">=</span> <span class="nx">bmlForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select[name$=&#39;_year&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">bmlForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select[name$=&#39;_year&#39;]&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">);</span>
			<span class="nx">bmlForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select[name$=&#39;_month&#39;]&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">);</span>
			<span class="nx">bmlForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select[name$=&#39;_day&#39;]&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">);</span>
			<span class="nx">bmlForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_ssn&#39;]&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nx">app</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">setCCFields</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>fill the form / clear the former cvn input</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccOwner</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">holder</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccType</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccNum</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">maskedNumber</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccMonth</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">expirationMonth</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccYear</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">expirationYear</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccCcv</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>remove error messages</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.errormessage&quot;</span><span class="p">)</span>
						  <span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s2">&quot;errormessage&quot;</span><span class="p">)</span>
						  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;span&quot;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>

		<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.errorlabel&quot;</span><span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s2">&quot;errorlabel&quot;</span><span class="p">);</span>
	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <p>updates the credit card form with the attributes of a given card</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">function</span> <span class="nx">populateCreditCardForm</span><span class="p">(</span><span class="nx">cardID</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>load card details</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamToURL</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">billingSelectCC</span><span class="p">,</span> <span class="s2">&quot;creditCardUUID&quot;</span><span class="p">,</span> <span class="nx">cardID</span><span class="p">);</span>
		 <span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">getJson</span><span class="p">({</span>
			<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
			<span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
					<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">CC_LOAD_ERROR</span><span class="p">);</span>
					<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccList</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">cardID</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
				<span class="nx">setCCFields</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">});</span>
	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>loads billing address, Gift Certificates, Coupon and Payment methods</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">function</span> <span class="nx">billingLoad</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">paymentMethodId</span> <span class="p">)</span> <span class="k">return</span><span class="p">;</span>
		
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">paymentMethodId</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">changePaymentMethod</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
			
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>get selected payment method from payment method form</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">paymentMethodId</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">paymentMethodId</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;:checked&quot;</span><span class="p">);</span>
		<span class="nx">changePaymentMethod</span><span class="p">(</span><span class="nx">paymentMethodId</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span> <span class="o">?</span> <span class="s2">&quot;CREDIT_CARD&quot;</span> <span class="o">:</span> <span class="nx">paymentMethodId</span><span class="p">.</span><span class="nx">val</span><span class="p">());</span></pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <p>select credit card from list</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccList</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">cardUUID</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">cardUUID</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
			<span class="kd">var</span> <span class="nx">ccdata</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">ccList</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="nx">cardUUID</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">ccdata</span> <span class="o">&amp;&amp;</span> <span class="nx">ccdata</span><span class="p">.</span><span class="nx">holder</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">setCCFields</span><span class="p">(</span><span class="nx">ccdata</span><span class="p">);</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="nx">populateCreditCardForm</span><span class="p">(</span><span class="nx">cardUUID</span><span class="p">);</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <p>handle whole form submit (bind click to continue checkout button)
append form fields of current payment form to this submit
in order to validate the payment method form inputs too</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">save</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p>determine if the order total was paid using gift cert or a promotion</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#noPaymentNeeded&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.giftcertpi&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <p>as a safety precaution, uncheck any existing payment methods</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$cache</span><span class="p">.</span><span class="nx">paymentMethodId</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;:checked&quot;</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;checked&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>add selected radio button with gift card payment method</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;input/&gt;&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
									<span class="nx">name</span><span class="o">:</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">paymentMethodId</span><span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
									<span class="nx">type</span><span class="o">:</span><span class="s2">&quot;radio&quot;</span><span class="p">,</span>
									<span class="nx">checked</span><span class="o">:</span><span class="s2">&quot;checked&quot;</span><span class="p">,</span>
									<span class="nx">value</span><span class="o">:</span><span class="nx">app</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">PI_METHOD_GIFT_CERTIFICATE</span><span class="p">})</span>
							 <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">);</span>
			<span class="p">}</span>
			
			<span class="kd">var</span> <span class="nx">tc</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;bml_termsandconditions&#39;]&quot;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">paymentMethodId</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;:checked&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">===</span><span class="s2">&quot;BML&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;bml_termsandconditions&#39;]&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">alert</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">BML_AGREE_TO_TERMS</span><span class="p">);</span>
				<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
			<span class="p">}</span>
			
		<span class="p">});</span>

		<span class="nx">$cache</span><span class="p">.</span><span class="nx">gcCheckBalance</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">gcCode</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">gcCode</span> <span class="o">||</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_giftCertCode&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">balance</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">balance</span> <span class="o">||</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;div.balance&quot;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">gcCode</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span> <span class="o">||</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">gcCode</span><span class="p">.</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">balance</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;span.error&quot;</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">error</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;span&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">balance</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="nx">error</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">GIFT_CERT_MISSING</span><span class="p">);</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			
			<span class="nx">app</span><span class="p">.</span><span class="nx">giftcard</span><span class="p">.</span><span class="nx">checkBalance</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">gcCode</span><span class="p">.</span><span class="nx">val</span><span class="p">(),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">data</span> <span class="o">||</span> <span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">giftCertificate</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>error</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">balance</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;span.error&quot;</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">error</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;span&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">balance</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="nx">error</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">GIFT_CERT_INVALID</span><span class="p">);</span>
					<span class="k">return</span><span class="p">;</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>display details in UI</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$cache</span><span class="p">.</span><span class="nx">balance</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;span.error&quot;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">balance</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">giftCertificate</span><span class="p">.</span><span class="nx">balance</span><span class="p">;</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">balance</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">GIFT_CERT_BALANCE</span><span class="o">+</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">balance</span><span class="p">);</span>
			<span class="p">});</span>
		<span class="p">});</span>
		
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">addCoupon</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">couponCode</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">couponCode</span> <span class="o">||</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_couponCode&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">redemption</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">redemption</span> <span class="o">||</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;div.redemption.coupon&quot;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">couponCode</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> 
				<span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">redemption</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;span.error&quot;</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">error</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;span&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">redemption</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="nx">error</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">COUPON_CODE_MISSING</span><span class="p">);</span>					
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			
			<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">addCoupon</span><span class="p">,</span> <span class="p">{</span><span class="nx">couponCode</span><span class="o">:</span><span class="nx">val</span><span class="p">,</span><span class="nx">format</span><span class="o">:</span><span class="s2">&quot;ajax&quot;</span><span class="p">});</span>
			<span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">fail</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
				<span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">msg</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">BAD_RESPONSE</span><span class="p">;</span>
					<span class="nx">fail</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">msg</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">;</span>
					<span class="nx">fail</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">fail</span><span class="p">)</span> <span class="p">{</span>
					<span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">redemption</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;span.error&quot;</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;span&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">redemption</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="nx">error</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>					
					<span class="k">return</span><span class="p">;</span>
				<span class="p">}</span>
				
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">redemption</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
			<span class="p">});</span>
		<span class="p">});</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeDom</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">isShipping</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.checkout-shipping&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>

	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeCache</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;form.address&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressList</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.select-address select[id$=&#39;_addressList&#39;]&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_firstName&#39;]&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_lastName&#39;]&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">address1</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_address1&#39;]&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">address2</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_address2&#39;]&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">city</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_city&#39;]&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">postalCode</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_zip&#39;]&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">phone</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_phone&#39;]&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">countryCode</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select[id$=&#39;_country&#39;]&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">stateCode</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select[id$=&#39;_state&#39;]&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">addToAddressBook</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_addToAddressBook&#39;]&quot;</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;checkout-shipping&quot;</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>shipping only</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$cache</span><span class="p">.</span><span class="nx">useForBilling</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_useAsBillingAddress&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">giftMessage</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.gift-message-text&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">shippingMethodList</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#shipping-method-list&quot;</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;checkout-billing&quot;</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>billing only</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$cache</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_emailAddress&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">save</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;button[name$=&#39;_billing_save&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">paymentMethods</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;div.payment-method&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">paymentMethodId</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">checkoutForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_selectedPaymentMethodID&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#PaymentMethod_CREDIT_CARD&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccList</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#creditCardList&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccOwner</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">ccContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;creditCard_owner&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccType</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">ccContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select[name$=&#39;_type&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccNum</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">ccContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_number&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccMonth</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">ccContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_month&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccYear</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">ccContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_year&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">ccCcv</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">ccContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_cvn&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">BMLContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#PaymentMethod_BML&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">gcCheckBalance</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#gc-checkbalance&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">addCoupon</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#add-coupon&quot;</span><span class="p">);</span>
			
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">addressLoad</span><span class="p">();</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">isShipping</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">shippingLoad</span><span class="p">();</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="nx">billingLoad</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/******* app.checkout public object ********/</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">checkout</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">initializeCache</span><span class="p">();</span>
			<span class="nx">initializeDom</span><span class="p">();</span>
			<span class="nx">initializeEvents</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p>app.quickview</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{};</span>

	<span class="kd">function</span> <span class="nx">bindQvButton</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">qvButton</span><span class="p">.</span><span class="nx">one</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">),</span>
				<span class="nx">source</span> <span class="o">:</span> <span class="s2">&quot;quickview&quot;</span>
			<span class="p">});</span>
		<span class="p">});</span>
	<span class="p">}</span>


	<span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">initializeButton</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <p>quick view button</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;mouseenter&quot;</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">qvButton</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">qvButton</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;a id=&#39;quickviewbutton&#39;/&gt;&quot;</span><span class="p">);</span>					
				<span class="p">}</span>
				<span class="nx">bindQvButton</span><span class="p">();</span>
				
				<span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;a:first&quot;</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">qvButton</span><span class="p">.</span><span class="nx">attr</span><span class="p">({</span>
					<span class="s2">&quot;href&quot;</span> <span class="o">:</span> <span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">),</span>
					<span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
				<span class="p">}).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
			<span class="p">});</span>
		<span class="p">},</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">exists</span><span class="p">())</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div/&gt;&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;#QuickViewDialog&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
			<span class="k">return</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span><span class="p">;</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <p>show quick view dialog and send request to the server to get the product
options.source - source of the dialog i.e. search/cart
options.url - product url</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">show</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="nx">options</span><span class="p">.</span><span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
					<span class="nx">target</span> <span class="o">:</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span><span class="p">,</span>
					<span class="nx">options</span> <span class="o">:</span> <span class="p">{</span>
						<span class="nx">height</span> <span class="o">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
						<span class="nx">width</span> <span class="o">:</span> <span class="mi">920</span><span class="p">,</span>
						<span class="nx">dialogClass</span> <span class="o">:</span> <span class="s1">&#39;quickview&#39;</span><span class="p">,</span>
						<span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Product Quickview&#39;</span><span class="p">,</span>
						<span class="nx">resizable</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
						<span class="nx">position</span> <span class="o">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
						<span class="nx">open</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>							
							<span class="nx">app</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
						<span class="p">}</span>
					<span class="p">}</span>
				<span class="p">});</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">);</span>
			<span class="p">};</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>

			<span class="k">return</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span><span class="p">;</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <p>close the quick view dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">close</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span>
				<span class="k">return</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">},</span>
		<span class="nx">exists</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">isActive</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">container</span> <span class="o">:</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">quickView</span>
	<span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <p>app.util</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>sub namespace app.util.* contains utility functions</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">app</span><span class="p">.</span><span class="nx">util</span> <span class="o">=</span> <span class="p">{</span>
		</pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p>trims a prefix from a given string, this can be used to trim
a certain prefix from DOM element IDs for further processing on the ID</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">trimPrefix</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">prefix</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
		<span class="p">},</span>

		<span class="nx">setDialogify</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">actionSource</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>			
				<span class="nx">dlgAction</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">actionSource</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;dlg-action&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">{},</span> <span class="c1">// url, target, isForm</span>
				<span class="nx">dlgOptions</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">settings</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">actionSource</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;dlg-options&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="p">{});</span>
				
			<span class="nx">dlgOptions</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">dlgOptions</span><span class="p">.</span><span class="nx">title</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="nx">actionSource</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>

			<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">dlgAction</span><span class="p">.</span><span class="nx">url</span> <span class="c1">// url from data</span>
					  <span class="o">||</span> <span class="p">(</span><span class="nx">dlgAction</span><span class="p">.</span><span class="nx">isForm</span> <span class="o">?</span> <span class="nx">$</span><span class="p">(</span><span class="nx">actionSource</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">)</span> <span class="c1">// or url from form action if isForm=true</span>
					  <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="nx">actionSource</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">);</span> <span class="c1">// or url from href</span>

			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
			
			<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)</span><span class="o">||</span><span class="s2">&quot;POST&quot;</span><span class="p">;</span>
			</pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>if this is a content link, update url from Page-Show to Page-Include</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;attributecontentlink&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">uri</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getUri</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
				<span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">pageInclude</span><span class="o">+</span><span class="nx">uri</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">method</span> <span class="o">&amp;&amp;</span> <span class="nx">method</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">)</span> 
			<span class="p">{</span>
		         <span class="kd">var</span> <span class="nx">postData</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">+</span> <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;=submit&quot;</span><span class="p">;</span>
		    <span class="p">}</span> 
			<span class="k">else</span> 
			<span class="p">{</span>
		         <span class="k">if</span> <span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span> 
		         <span class="p">{</span>
		          <span class="nx">url</span><span class="o">+=</span><span class="s1">&#39;?&#39;</span><span class="p">;</span>
		         <span class="p">}</span> 
		         <span class="k">else</span> 
		         <span class="p">{</span>
		          <span class="nx">url</span> <span class="o">+=</span> <span class="s1">&#39;&amp;&#39;</span>
		         <span class="p">}</span>
		         <span class="nx">url</span> <span class="o">+=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">();</span>
		         <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamToURL</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">jQuery</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="s2">&quot;submit&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			
			<span class="kd">var</span> <span class="nx">dlg</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span><span class="nx">target</span><span class="o">:</span><span class="nx">dlgAction</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">options</span> <span class="o">:</span> <span class="nx">dlgOptions</span><span class="p">});</span>

			<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span>
				<span class="nx">url</span><span class="o">:</span><span class="nx">$</span><span class="p">(</span><span class="nx">actionSource</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="nx">actionSource</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">),</span>
				<span class="nx">target</span><span class="o">:</span><span class="nx">dlg</span><span class="p">,</span> <span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="nx">dlg</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>	<span class="c1">// open after load to ensure dialog is centered</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span> <span class="c1">// re-init validator</span>
				<span class="p">},</span>
				<span class="nx">data</span> <span class="o">:</span> <span class="o">!</span><span class="nx">$</span><span class="p">(</span><span class="nx">actionSource</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">postData</span> <span class="o">:</span> <span class="kc">null</span>
				
			<span class="p">});</span>
		<span class="p">},</span>

		<span class="nx">padLeft</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">padChar</span><span class="p">,</span> <span class="nx">len</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">digs</span> <span class="o">=</span> <span class="nx">len</span> <span class="o">||</span> <span class="mi">10</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">dif</span> <span class="o">=</span> <span class="nx">digs</span> <span class="o">-</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
			<span class="k">while</span><span class="p">(</span><span class="nx">dif</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">s</span> <span class="o">=</span> <span class="nx">padChar</span> <span class="o">+</span> <span class="nx">s</span><span class="p">;</span>
				<span class="nx">dif</span><span class="o">--</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">s</span><span class="p">;</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p>appends the parameter with the given name and
value to the given url and returns the changed url</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">appendParamToURL</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">c</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">url</span> <span class="o">+</span> <span class="nx">c</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
		<span class="p">},</span>

		<span class="nx">appendParamsToUrl</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>			
			<span class="kd">var</span> <span class="nx">uri</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getUri</span><span class="p">(</span><span class="nx">url</span><span class="p">),</span>
				<span class="nx">includeHash</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			
			<span class="kd">var</span> <span class="nx">qsParams</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">uri</span><span class="p">.</span><span class="nx">queryParams</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">path</span><span class="o">+</span><span class="s2">&quot;?&quot;</span><span class="o">+</span><span class="nx">$</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="nx">qsParams</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">includeHash</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">result</span><span class="o">+=</span><span class="nx">uri</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">result</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">!==</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">result</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nx">result</span><span class="p">;</span>	
			<span class="p">}</span>
			
			<span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
		<span class="p">},</span>

		<span class="nx">removeParamFromURL</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">parameter</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">urlparts</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">);</span>

			<span class="k">if</span><span class="p">(</span><span class="nx">urlparts</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">urlBase</span> <span class="o">=</span> <span class="nx">urlparts</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">queryString</span> <span class="o">=</span> <span class="nx">urlparts</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">);</span>

				<span class="kd">var</span> <span class="nx">prefix</span> <span class="o">=</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">parameter</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span><span class="p">;</span>
				<span class="kd">var</span> <span class="nx">pars</span> <span class="o">=</span> <span class="nx">queryString</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/[&amp;;]/g</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="nx">pars</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
				<span class="k">while</span><span class="p">(</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span><span class="p">(</span><span class="nx">pars</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">pars</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="nx">url</span> <span class="o">=</span> <span class="nx">urlBase</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="nx">pars</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">url</span><span class="p">;</span>
		<span class="p">},</span>

		<span class="nx">staticUrl</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">path</span> <span class="o">||</span> <span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">path</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">staticPath</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="k">return</span> <span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">staticPath</span> <span class="o">+</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span> <span class="o">?</span> <span class="nx">path</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="nx">path</span> <span class="p">);</span>
		<span class="p">},</span>

		<span class="nx">ajaxUrl</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamToURL</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;ajax&quot;</span><span class="p">);</span>
		<span class="p">},</span>
		
		<span class="nx">toAbsoluteUrl</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span><span class="o">!==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">url</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">!==</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nx">url</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">url</span><span class="p">;</span>
		<span class="p">},</span>

		<span class="nx">loadDynamicCss</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">urls</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="o">=</span><span class="nx">urls</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
			<span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">loadedCssFiles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">loadCssFile</span><span class="p">(</span><span class="nx">urls</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>dynamically loads a CSS file</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">loadCssFile</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;link/&gt;&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;head&quot;</span><span class="p">)).</span><span class="nx">attr</span><span class="p">({</span>
				<span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;text/css&quot;</span><span class="p">,</span>
				<span class="nx">rel</span> <span class="o">:</span> <span class="s2">&quot;stylesheet&quot;</span>
			<span class="p">}).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span> <span class="c1">// for i.e. &lt;9, href must be added after link has been appended to head</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p>array to keep track of the dynamically loaded CSS files</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">loadedCssFiles</span> <span class="o">:</span> <span class="p">[],</span></pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p>removes all dynamically loaded CSS files</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">clearDynamicCss</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">loadedCssFiles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
			<span class="k">while</span><span class="p">(</span><span class="mi">0</span> <span class="o">&gt;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">$</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">loadedCssFiles</span><span class="p">[</span><span class="nx">i</span><span class="p">]).</span><span class="nx">remove</span><span class="p">();</span>
			<span class="p">}</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">loadedCssFiles</span> <span class="o">=</span> <span class="p">[];</span>
		<span class="p">},</span>

		<span class="nx">getQueryStringParams</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">qs</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">qs</span> <span class="o">||</span> <span class="nx">qs</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{};</span> <span class="p">}</span>

			<span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">unescapedQS</span> <span class="o">=</span> <span class="nx">unescape</span><span class="p">(</span><span class="nx">qs</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p>Use the String::replace method to iterate over each
name-value pair in the string.</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">unescapedQS</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span> <span class="s2">&quot;([^?=&amp;]+)(=([^&amp;]*))?&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span> <span class="p">),</span>
						<span class="kd">function</span> <span class="p">(</span> <span class="nx">$0</span><span class="p">,</span> <span class="nx">$1</span><span class="p">,</span> <span class="nx">$2</span><span class="p">,</span> <span class="nx">$3</span> <span class="p">)</span> <span class="p">{</span>	<span class="nx">params</span><span class="p">[</span> <span class="nx">$1</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">$3</span><span class="p">;</span> <span class="p">}</span>
			<span class="p">);</span>
			<span class="k">return</span> <span class="nx">params</span><span class="p">;</span>
		<span class="p">},</span>

		<span class="nx">getUri</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">a</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="nx">o</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="nx">a</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">);</span>
				<span class="nx">a</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">o</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="k">return</span> <span class="p">{</span>
				<span class="nx">protocol</span> <span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">protocol</span><span class="p">,</span> <span class="c1">//http:</span>
				<span class="nx">host</span> <span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span> <span class="c1">//www.myexample.com</span>
				<span class="nx">hostname</span> <span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">hostname</span><span class="p">,</span> <span class="c1">//www.myexample.com&#39;</span>
				<span class="nx">port</span> <span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="c1">//:80</span>
				<span class="nx">path</span> <span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">pathname</span><span class="p">,</span> <span class="c1">// /sub1/sub2</span>
				<span class="nx">query</span> <span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">search</span><span class="p">,</span> <span class="c1">// ?param1=val1&amp;param2=val2</span>
				<span class="nx">queryParams</span> <span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getQueryStringParams</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">:</span> <span class="p">{},</span>
				<span class="nx">hash</span> <span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">hash</span><span class="p">,</span> <span class="c1">// #OU812,5150</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">protocol</span><span class="o">+</span> <span class="s2">&quot;//&quot;</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">pathname</span><span class="p">,</span>
				<span class="nx">urlWithQuery</span> <span class="o">:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">protocol</span><span class="o">+</span> <span class="s2">&quot;//&quot;</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">host</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">port</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">search</span>
			<span class="p">};</span>
		<span class="p">},</span>

		<span class="nx">postForm</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;form&gt;&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span><span class="nx">action</span><span class="o">:</span><span class="nx">args</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span><span class="nx">method</span><span class="o">:</span><span class="s2">&quot;post&quot;</span><span class="p">}).</span><span class="nx">appendTo</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">p</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="nx">p</span> <span class="k">in</span> <span class="nx">args</span><span class="p">.</span><span class="nx">fields</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;input&gt;&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span><span class="nx">p</span><span class="p">,</span><span class="nx">value</span><span class="o">:</span><span class="nx">args</span><span class="p">.</span><span class="nx">fields</span><span class="p">[</span><span class="nx">p</span><span class="p">]}).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">form</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="nx">form</span><span class="p">.</span><span class="nx">submit</span><span class="p">();</span>
		<span class="p">},</span>

		<span class="nx">getMessage</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">bundleName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">callback</span> <span class="o">||</span> <span class="o">!</span><span class="nx">key</span> <span class="o">||</span> <span class="nx">key</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span><span class="nx">key</span><span class="o">:</span><span class="nx">key</span><span class="p">};</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">bundleName</span> <span class="o">&amp;&amp;</span> <span class="nx">bundleName</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">params</span><span class="p">.</span><span class="nx">bn</span> <span class="o">=</span> <span class="nx">bundleName</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">appResources</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
			<span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
		<span class="p">},</span>
		
		<span class="nx">updateStateOptions</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">countrySelect</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">country</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">countrySelect</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">country</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span> <span class="o">||</span> <span class="o">!</span><span class="nx">app</span><span class="p">.</span><span class="nx">countries</span><span class="p">[</span><span class="nx">country</span><span class="p">.</span><span class="nx">val</span><span class="p">()])</span> <span class="p">{</span>
				 <span class="k">return</span><span class="p">;</span> 
			<span class="p">}</span>
			<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">country</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">stateField</span> <span class="o">=</span> <span class="nx">country</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;stateField&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">country</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;stateField&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select[name$=&#39;_state&#39;]&quot;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">stateField</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			
			<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">country</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">),</span>	
				<span class="nx">c</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">countries</span><span class="p">[</span><span class="nx">country</span><span class="p">.</span><span class="nx">val</span><span class="p">()],</span>
				<span class="nx">arrHtml</span> <span class="o">=</span> <span class="p">[],</span>
				<span class="nx">labelSpan</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;label[for=&#39;&quot;</span><span class="o">+</span><span class="nx">stateField</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="o">+</span><span class="s2">&quot;&#39;] span&quot;</span><span class="p">).</span><span class="nx">not</span><span class="p">(</span><span class="s2">&quot;.required-indicator&quot;</span><span class="p">);</span>
			</pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>set the label text</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">labelSpan</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">label</span><span class="p">);</span>
	
			<span class="kd">var</span> <span class="nx">s</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="nx">s</span> <span class="k">in</span> <span class="nx">c</span><span class="p">.</span><span class="nx">regions</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">arrHtml</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;&lt;option value=&quot;&#39;</span><span class="o">+</span><span class="nx">s</span><span class="o">+</span><span class="s1">&#39;&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">c</span><span class="p">.</span><span class="nx">regions</span><span class="p">[</span><span class="nx">s</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;&lt;/option&gt;&#39;</span><span class="p">);</span>
			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p>clone the empty option item and add to stateSelect</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">o1</span> <span class="o">=</span> <span class="nx">stateField</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">first</span><span class="p">().</span><span class="nx">clone</span><span class="p">();</span>
			<span class="nx">stateField</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">arrHtml</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">).</span><span class="nx">children</span><span class="p">().</span><span class="nx">first</span><span class="p">().</span><span class="nx">before</span><span class="p">(</span><span class="nx">o1</span><span class="p">);</span>
			<span class="nx">stateField</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">selectedIndex</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
		<span class="p">},</span>
		
		<span class="nx">limitCharacters</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;textarea[data-character-limit]&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>				
				<span class="kd">var</span> <span class="nx">characterLimit</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;character-limit&quot;</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">charCountHtml</span> <span class="o">=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">CHAR_LIMIT_MSG</span><span class="p">,</span> 
										<span class="s1">&#39;&lt;span class=&quot;char-remain-count&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">characterLimit</span><span class="o">+</span><span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">,</span>
										<span class="s1">&#39;&lt;span class=&quot;char-allowed-count&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">characterLimit</span><span class="o">+</span><span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">charCountContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">next</span><span class="p">(</span><span class="s1">&#39;div.char-count&#39;</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="nx">charCountContainer</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">charCountContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;char-count&quot;/&gt;&#39;</span><span class="p">).</span><span class="nx">insertAfter</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
				<span class="p">}</span>
				<span class="nx">charCountContainer</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">charCountHtml</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-165">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-165">&#182;</a>               </div>               <p>trigger the keydown event so that any existing character data is calculated</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">change</span><span class="p">();</span>
			<span class="p">});</span>
		<span class="p">},</span>
		
		<span class="nx">setDeleteConfirmation</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.delete&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
				<span class="k">return</span> <span class="nx">confirm</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
			<span class="p">});</span>
		<span class="p">},</span>
		
		<span class="nx">scrollBrowser</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">xLocation</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;html, body&#39;</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">scrollTop</span><span class="o">:</span> <span class="nx">xLocation</span> <span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
		<span class="p">}</span>

	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-166">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-166">&#182;</a>               </div>               <p>app.page</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">page</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">title</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
		<span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
		<span class="nx">setContext</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">page</span><span class="p">,</span> <span class="nx">o</span><span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">params</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">getQueryStringParams</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
		<span class="nx">redirect</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">newURL</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="nx">setTimeout</span><span class="p">(</span><span class="s2">&quot;window.location.href=&#39;&quot;</span><span class="o">+</span><span class="nx">newURL</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">refresh</span> <span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="nx">setTimeout</span><span class="p">(</span><span class="s2">&quot;window.location.assign(window.location.href);&quot;</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
			
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-167">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-167">&#182;</a>               </div>               <p>app.registry</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{};</span>

	<span class="kd">function</span> <span class="nx">populateBeforeAddressForm</span><span class="p">(</span><span class="nx">addressID</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-168">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-168">&#182;</a>               </div>               <p>load address details</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">giftRegAdd</span> <span class="o">+</span> <span class="nx">addressID</span><span class="p">;</span>
		 <span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">getJson</span><span class="p">({</span>
			<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
			<span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">data</span> <span class="o">||</span> <span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">)</span> <span class="p">{</span>
					<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">REG_ADDR_ERROR</span><span class="p">);</span>
					<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-169">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-169">&#182;</a>               </div>               <p>fill the form</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_addressid&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">ID</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_firstname&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">firstName</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_lastname&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">lastName</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_address1&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">address1</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_address2&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">address2</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_city&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">city</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_zip&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">postalCode</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_state&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">stateCode</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_country&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">countryCode</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_phone&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">phone</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">registryForm</span><span class="p">.</span><span class="nx">validate</span><span class="p">().</span><span class="nx">form</span><span class="p">();</span>
			<span class="p">}</span>
		<span class="p">});</span>
	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-170">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-170">&#182;</a>               </div>               <p>updates the after address form with the attributes of a given address</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">function</span> <span class="nx">populateAfterAddressForm</span><span class="p">(</span><span class="nx">addressID</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-171">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-171">&#182;</a>               </div>               <p>load address details</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">giftRegAdd</span> <span class="o">+</span> <span class="nx">addressID</span><span class="p">;</span>
		 <span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">getJson</span><span class="p">({</span>
			<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
			<span class="nx">callback</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">data</span> <span class="o">||</span> <span class="o">!</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">)</span> <span class="p">{</span>
					<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">REG_ADDR_ERROR</span><span class="p">);</span>
					<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-172">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-172">&#182;</a>               </div>               <p>fill the form</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_addressid&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">ID</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_firstname&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">firstName</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_lastname&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">lastName</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_address1&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">address1</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_address2&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">address2</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_city&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">city</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_zip&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">postalCode</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_state&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">stateCode</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_country&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">countryCode</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_phone&#39;]&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">address</span><span class="p">.</span><span class="nx">phone</span><span class="p">);</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">registryForm</span><span class="p">.</span><span class="nx">validate</span><span class="p">().</span><span class="nx">form</span><span class="p">();</span>
			<span class="p">}</span>
		<span class="p">});</span>
	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-173">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-173">&#182;</a>               </div>               <p>copy address before fields to address after fields</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">function</span> <span class="nx">copyBeforeAddress</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">fieldName</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">afterField</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name=&#39;&quot;</span><span class="o">+</span><span class="nx">fieldName</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;Before&quot;</span><span class="p">,</span><span class="s2">&quot;After&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">afterField</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
		<span class="p">});</span>
	<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-174">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-174">&#182;</a>               </div>               <p>disable the address after fields</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">function</span> <span class="nx">setAfterAddressDisabled</span><span class="p">(</span><span class="nx">disabled</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">disabled</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">,</span> <span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s2">&quot;disabled&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeCache</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span> <span class="o">=</span> <span class="p">{</span>
			<span class="nx">registryForm</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;form[name$=&#39;_giftregistry&#39;]&quot;</span><span class="p">),</span>
			<span class="nx">registryTable</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#registry-results&quot;</span><span class="p">)</span>
		<span class="p">};</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">copyAddress</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">registryForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_copyAddress&#39;]&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">registryForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;fieldset[name=&#39;address-before&#39;] input:not(:checkbox), fieldset[name=&#39;address-before&#39;] select&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">registryForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;fieldset[name=&#39;address-after&#39;] input:not(:checkbox), fieldset[name=&#39;address-after&#39;] select&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeDom</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_country&#39;]&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;stateField&quot;</span><span class="p">,</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_state&#39;]&quot;</span><span class="p">));</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_country&#39;]&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;stateField&quot;</span><span class="p">,</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_state&#39;]&quot;</span><span class="p">));</span>		
		
		<span class="k">if</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">copyAddress</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">copyAddress</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-175">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-175">&#182;</a>               </div>               <p>fill the address after fields</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">copyBeforeAddress</span><span class="p">();</span>
			<span class="nx">setAfterAddressDisabled</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">app</span><span class="p">.</span><span class="nx">sendToFriend</span><span class="p">.</span><span class="nx">initializeDialog</span><span class="p">(</span><span class="s2">&quot;div.list-table-header&quot;</span><span class="p">,</span> <span class="s2">&quot;.send-to-friend&quot;</span><span class="p">);</span>
		<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">setDeleteConfirmation</span><span class="p">(</span><span class="s2">&quot;table.item-list&quot;</span><span class="p">,</span> <span class="nb">String</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">CONFIRM_DELETE</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">TITLE_GIFTREGISTRY</span><span class="p">));</span>
		
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">copyAddress</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-176">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-176">&#182;</a>               </div>               <p>fill the address after fields</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">copyBeforeAddress</span><span class="p">();</span>
			<span class="p">}</span>
		<span class="p">});</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">registryForm</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="s2">&quot;select[name$=&#39;_addressBeforeList&#39;]&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">addressID</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">addressID</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
			<span class="nx">populateBeforeAddressForm</span><span class="p">(</span><span class="nx">addressID</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">copyAddress</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">copyBeforeAddress</span><span class="p">();</span>
			<span class="p">}</span>
		<span class="p">})</span>
		<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="s2">&quot;select[name$=&#39;_addressAfterList&#39;]&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">addressID</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">addressID</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
			<span class="nx">populateAfterAddressForm</span><span class="p">(</span><span class="nx">addressID</span><span class="p">);</span>
		<span class="p">})</span>
		<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">addressBeforeFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;:not([name$=&#39;_country&#39;])&quot;</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">copyAddress</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
			<span class="nx">copyBeforeAddress</span><span class="p">();</span>			
		<span class="p">});</span>
		
		
		<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="s2">&quot;select[name$=&#39;_country&#39;]&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">updateStateOptions</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
			
			<span class="k">if</span> <span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">copyAddress</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">copyAddress</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">checked</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;_addressBefore&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">copyBeforeAddress</span><span class="p">();</span>
				<span class="nx">$cache</span><span class="p">.</span><span class="nx">addressAfterFields</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s2">&quot;[name$=&#39;_country&#39;]&quot;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">});</span>
	<span class="p">}</span>


	<span class="nx">app</span><span class="p">.</span><span class="nx">registry</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>			
			<span class="nx">initializeCache</span><span class="p">();</span>
			<span class="nx">initializeDom</span><span class="p">();</span>
			<span class="nx">initializeEvents</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">initAddToCart</span><span class="p">();</span>
			
		<span class="p">}</span>

	<span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-177">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-177">&#182;</a>               </div>               <p>app.progress</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">loader</span><span class="p">;</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">progress</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">show</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nx">container</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">).</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">);</span>
			<span class="nx">loader</span> <span class="o">=</span> <span class="nx">loader</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.loader&quot;</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="nx">loader</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">loader</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div/&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;loader&quot;</span><span class="p">)</span>
									<span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div/&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;loader-indicator&quot;</span><span class="p">),</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div/&gt;&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;loader-bg&quot;</span><span class="p">));</span>

			<span class="p">}</span>
			<span class="k">return</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">target</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
		<span class="p">},</span>
		<span class="nx">hide</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">loader</span><span class="p">)</span> <span class="p">{</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span> <span class="p">}</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-178">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-178">&#182;</a>               </div>               <p>app.components</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">dw</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-179">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-179">&#182;</a>               </div>               <p>capture recommendation of each product when it becomes visible in the carousel</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">function</span> <span class="nx">captureCarouselRecommendations</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">li</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">dw</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>

		<span class="nx">$</span><span class="p">(</span><span class="nx">li</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.capture-product-id&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">dw</span><span class="p">.</span><span class="nx">ac</span><span class="p">.</span><span class="nx">capture</span><span class="p">({</span>
				<span class="nx">id</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">text</span><span class="p">(),</span>
				<span class="nx">type</span> <span class="o">:</span> <span class="nx">dw</span><span class="p">.</span><span class="nx">ac</span><span class="p">.</span><span class="nx">EV_PRD_RECOMMENDATION</span>
			<span class="p">});</span>
		<span class="p">});</span>
	<span class="p">}</span>


	<span class="nx">app</span><span class="p">.</span><span class="nx">components</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">carouselSettings</span> <span class="o">:</span> <span class="p">{</span>
			<span class="nx">scroll</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
			<span class="nx">itemFallbackDimension</span><span class="o">:</span> <span class="s1">&#39;100%&#39;</span><span class="p">,</span>
			<span class="nx">itemVisibleInCallback</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">captureCarouselRecommendations</span>
		<span class="p">},</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-180">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-180">&#182;</a>               </div>               <p>renders horizontal/vertical carousels for product slots</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#vertical-carousel&#39;</span><span class="p">).</span><span class="nx">jcarousel</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">vertical</span> <span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="nx">app</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">carouselSettings</span><span class="p">));</span>
			<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#horizontal-carousel&#39;</span><span class="p">).</span><span class="nx">jcarousel</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">carouselSettings</span><span class="p">);</span>
			<span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nb">window</span><span class="p">.</span><span class="nx">dw</span><span class="p">,</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-181">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-181">&#182;</a>               </div>               <p>app.cart</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{};</span>

	<span class="kd">function</span> <span class="nx">updateCart</span><span class="p">(</span><span class="nx">postdata</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">ajaxUrl</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">addProduct</span><span class="p">);</span>
		<span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">postdata</span><span class="p">,</span> <span class="nx">callback</span> <span class="o">||</span> <span class="nx">app</span><span class="p">.</span><span class="nx">cart</span><span class="p">.</span><span class="nx">refresh</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeCache</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span> <span class="o">=</span> <span class="p">{</span>
			<span class="nx">cartTable</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#cart-table&quot;</span><span class="p">),</span>
			<span class="nx">itemsForm</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#cart-items-form&quot;</span><span class="p">),</span>
			<span class="nx">addCoupon</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#add-coupon&quot;</span><span class="p">),</span>
			<span class="nx">couponCode</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;form input[name$=&#39;_couponCode&#39;]&quot;</span><span class="p">)</span>
		<span class="p">};</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">cartTable</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.item-edit-details a&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
				<span class="nx">source</span> <span class="o">:</span> <span class="s2">&quot;cart&quot;</span>
			<span class="p">});</span>
		<span class="p">})</span>
		<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.bonus-item-actions a&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">bonusProductsView</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
		<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-182">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-182">&#182;</a>               </div>               <p>override enter key for coupon code entry</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">$cache</span><span class="p">.</span><span class="nx">couponCode</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;keydown&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">===</span> <span class="mi">13</span> <span class="o">&amp;&amp;</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
		<span class="p">});</span>
	<span class="p">}</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">cart</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">add</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">postdata</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">updateCart</span><span class="p">(</span><span class="nx">postdata</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">remove</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">},</span>
		<span class="nx">update</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">postdata</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">updateCart</span><span class="p">(</span><span class="nx">postdata</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
		<span class="p">},</span>
		<span class="nx">refresh</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-183">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-183">&#182;</a>               </div>               <p>refresh without posting</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">app</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
		<span class="p">},</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-184">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-184">&#182;</a>               </div>               <p>edit shopping cart line item</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">initializeCache</span><span class="p">();</span>
			<span class="nx">initializeEvents</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">};</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-185">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-185">&#182;</a>               </div>               <p>app.account</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{};</span>
	
	<span class="kd">function</span> <span class="nx">initializeAddressForm</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>			
		<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#edit-address-form&quot;</span><span class="p">);</span>
		
		<span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;format&#39;]&quot;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
		<span class="nx">app</span><span class="p">.</span><span class="nx">tooltips</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-186">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-186">&#182;</a>               </div>               <p>$("<input/>").attr({type:"hidden", name:"format", value:"ajax"}).appendTo(form);</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">form</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.apply-button&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">addressId</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name$=&#39;_addressid&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">addressId</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">addressId</span><span class="p">.</span><span class="nx">val</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[^\w+-]/g</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">form</span><span class="p">.</span><span class="nx">valid</span><span class="p">())</span> <span class="p">{</span>
				<span class="k">return</span> <span class="kc">false</span><span class="p">;</span> 
			<span class="p">}</span>
			<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">),{</span><span class="nx">format</span><span class="o">:</span><span class="s2">&quot;ajax&quot;</span><span class="p">});</span>
			<span class="kd">var</span> <span class="nx">applyName</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.apply-button&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
				<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
				<span class="nx">data</span><span class="o">:</span> <span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;&amp;&quot;</span><span class="o">+</span><span class="nx">applyName</span><span class="o">+</span><span class="s1">&#39;=x&#39;</span><span class="p">,</span>
				<span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span>
			<span class="p">};</span>
			<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span> <span class="nx">options</span> <span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
				<span class="k">if</span><span class="p">(</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="o">!==</span><span class="s1">&#39;string&#39;</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span> <span class="nx">data</span><span class="p">.</span><span class="nx">success</span> <span class="p">)</span> <span class="p">{</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="nx">alert</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
						<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dialog-container&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">tooltips</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
				<span class="p">}</span>
			<span class="p">});</span>
		<span class="p">})</span>
		<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.cancel-button, .close-button&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
		<span class="p">})</span>
		<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.delete-button&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">confirm</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">CONFIRM_DELETE</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">TITLE_ADDRESS</span><span class="p">)))</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">deleteAddress</span><span class="p">,</span> <span class="p">{</span><span class="nx">AddressID</span><span class="o">:</span><span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;#addressid&quot;</span><span class="p">).</span><span class="nx">val</span><span class="p">(),</span><span class="nx">format</span><span class="o">:</span><span class="s2">&quot;ajax&quot;</span><span class="p">});</span>
				<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
					<span class="nx">url</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
					<span class="nx">method</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
					<span class="nx">dataType</span><span class="o">:</span><span class="s2">&quot;json&quot;</span>
				<span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span><span class="o">===</span><span class="s2">&quot;ok&quot;</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">alert</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
						<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>
					<span class="p">}</span>
				<span class="p">});</span>
			<span class="p">}</span>
		<span class="p">});</span>
		
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">countrySelect</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;select[id$=&#39;_country&#39;]&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">countrySelect</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span> 
			<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">updateStateOptions</span><span class="p">(</span><span class="k">this</span><span class="p">);</span> 
		<span class="p">});</span>
		
		<span class="nx">app</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">toggleFullOrder</span> <span class="p">()</span> <span class="p">{</span>
		<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.order-items&#39;</span><span class="p">)</span>
			<span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;li.hidden:first&#39;</span><span class="p">)</span>
				<span class="p">.</span><span class="nx">prev</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)</span>
					<span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;a class=&quot;toggle&quot;&gt;View All&lt;/a&gt;&#39;</span><span class="p">)</span>
					<span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s1">&#39;.toggle&#39;</span><span class="p">)</span>
						<span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
							<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parent</span><span class="p">().</span><span class="nx">siblings</span><span class="p">(</span><span class="s1">&#39;li.hidden&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
							<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
						<span class="p">});</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">initAddressEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">addresses</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#addresses&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">addresses</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
		
		<span class="nx">addresses</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;a.address-edit, a.address-create&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span><span class="nx">open</span><span class="o">:</span> <span class="nx">initializeAddressForm</span><span class="p">};</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">open</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span> <span class="nx">options</span><span class="o">:</span><span class="nx">options</span><span class="p">});</span>
		<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.delete&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">confirm</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">CONFIRM_DELETE</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">TITLE_ADDRESS</span><span class="p">)))</span> <span class="p">{</span>
				<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
					<span class="nx">url</span><span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">),</span> <span class="p">{</span><span class="nx">format</span><span class="o">:</span><span class="s2">&quot;ajax&quot;</span><span class="p">}),</span>
					<span class="nx">dataType</span><span class="o">:</span><span class="s2">&quot;json&quot;</span>
				<span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
					<span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">status</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span><span class="o">===</span><span class="s2">&quot;ok&quot;</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">addressesList</span><span class="p">);</span>	
					<span class="p">}</span>
					<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">alert</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="nx">app</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>	
					<span class="p">}</span>
				<span class="p">});</span>
			<span class="p">}</span>
		<span class="p">});</span>		
	<span class="p">}</span>
	<span class="kd">function</span> <span class="nx">initPaymentEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">paymentList</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.payment-list&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">paymentList</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
		
		<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">setDeleteConfirmation</span><span class="p">(</span><span class="nx">paymentList</span><span class="p">,</span> <span class="nb">String</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">CONFIRM_DELETE</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">TITLE_CREDITCARD</span><span class="p">));</span>
		
		<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;form[name=&#39;payment-remove&#39;]&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-187">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-187">&#182;</a>               </div>               <p>override form submission in order to prevent refresh issues</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">button</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;button.delete&quot;</span><span class="p">);</span>
			<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;input/&gt;&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span><span class="nx">type</span><span class="o">:</span><span class="s2">&quot;hidden&quot;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span><span class="nx">button</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span> <span class="nx">value</span><span class="o">:</span><span class="nx">button</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="o">||</span><span class="s2">&quot;delete card&quot;</span><span class="p">}).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
			<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">serialize</span><span class="p">();</span> 
			<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
				<span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
				<span class="nx">url</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">),</span>
				<span class="nx">data</span><span class="o">:</span> <span class="nx">data</span>
			<span class="p">})</span>
			<span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">page</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">paymentsList</span><span class="p">);</span>	
			<span class="p">});</span>
		<span class="p">});</span>
	<span class="p">}</span>
	
	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">toggleFullOrder</span><span class="p">();</span>
		<span class="nx">initAddressEvents</span><span class="p">();</span>
		<span class="nx">initPaymentEvents</span><span class="p">();</span>
	<span class="p">}</span>
		
	<span class="nx">app</span><span class="p">.</span><span class="nx">account</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>			
			<span class="nx">initializeEvents</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-188">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-188">&#182;</a>               </div>               <p>app.wishlist</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{};</span>

	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">app</span><span class="p">.</span><span class="nx">sendToFriend</span><span class="p">.</span><span class="nx">initializeDialog</span><span class="p">(</span><span class="s2">&quot;div.list-table-header&quot;</span><span class="p">,</span> <span class="s2">&quot;.send-to-friend&quot;</span><span class="p">);</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">editAddress</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamToURL</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">wishlistAddress</span><span class="p">,</span> <span class="s2">&quot;AddressID&quot;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
		<span class="p">});</span>
		<span class="nx">$cache</span><span class="p">.</span><span class="nx">wishlistTable</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.item-details a&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">quickView</span><span class="p">.</span><span class="nx">show</span><span class="p">({</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span><span class="p">,</span>
				<span class="nx">source</span> <span class="o">:</span> <span class="s2">&quot;wishlist&quot;</span>
			<span class="p">});</span>
		<span class="p">})</span>
	<span class="p">}</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">wishlist</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">editAddress</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#editAddress&#39;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">wishlistTable</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.pt_wish-list .item-list&#39;</span><span class="p">);</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">product</span><span class="p">.</span><span class="nx">initAddToCart</span><span class="p">();</span>
			<span class="nx">initializeEvents</span><span class="p">();</span>
			
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-189">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-189">&#182;</a>               </div>               <p>app.minicart</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-190">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-190">&#182;</a>               </div>               <p>sub name space app.minicart.* provides functionality around the mini cart</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{},</span> 
		<span class="nx">initialized</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

	<span class="kd">var</span> <span class="nx">timer</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">id</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
		<span class="nx">clear</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">timer</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
				<span class="nb">window</span><span class="p">.</span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timer</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
				<span class="k">delete</span> <span class="nx">timer</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">},</span>
		<span class="nx">start</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">duration</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">timer</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">close</span><span class="p">,</span> <span class="nx">duration</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">};</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">minicart</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">url</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="c1">// during page loading, the Demandware URL is stored here</span></pre></div>             </td>           </tr>                               <tr id="section-191">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-191">&#182;</a>               </div>               <p>initializations</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">minicart</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#mini-cart&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">mcTotal</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.mini-cart-total&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">mcContent</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.mini-cart-content&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">mcClose</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.mini-cart-close&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">mcProductList</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.mini-cart-products&quot;</span><span class="p">);</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">mcProducts</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">mcProductList</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.mini-cart-product&quot;</span><span class="p">);</span>

			<span class="kd">var</span> <span class="nx">collapsed</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">mcProductList</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">not</span><span class="p">(</span><span class="s2">&quot;:first&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;collapsed&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-192">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-192">&#182;</a>               </div>               <p>bind hover event to the cart total link at the top right corner</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$cache</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;mouseenter&quot;</span><span class="p">,</span> <span class="s2">&quot;.mini-cart-total&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">mcContent</span><span class="p">.</span><span class="nx">not</span><span class="p">(</span><span class="s2">&quot;:visible&quot;</span><span class="p">))</span> <span class="p">{</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">slide</span><span class="p">();</span>
				<span class="p">}</span>
			<span class="p">})</span>
			<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;mouseenter&quot;</span><span class="p">,</span> <span class="s2">&quot;.mini-cart-content&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">timer</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
			<span class="p">})</span>
			<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;mouseleave&quot;</span><span class="p">,</span> <span class="s2">&quot;.mini-cart-content&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">timer</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
				<span class="nx">timer</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
			<span class="p">})</span>
			<span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;.mini-cart-close&quot;</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">close</span><span class="p">);</span>

			<span class="nx">$cache</span><span class="p">.</span><span class="nx">mcProducts</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;mini-cart-toggler&quot;&gt;&amp;nbsp;&lt;/div&gt;&#39;</span><span class="p">);</span>

			<span class="nx">$cache</span><span class="p">.</span><span class="nx">mcProductList</span><span class="p">.</span><span class="nx">toggledList</span><span class="p">({</span><span class="nx">toggleClass</span> <span class="o">:</span> <span class="s2">&quot;collapsed&quot;</span><span class="p">,</span> <span class="nx">triggerSelector</span><span class="o">:</span><span class="s2">&quot;.mini-cart-toggler&quot;</span><span class="p">,</span> <span class="nx">eventName</span><span class="o">:</span><span class="s2">&quot;click&quot;</span><span class="p">});</span>

			<span class="nx">initialized</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-193">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-193">&#182;</a>               </div>               <p>shows the given content in the mini cart</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">show</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">scrollBrowser</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">slide</span><span class="p">();</span>
			<span class="nx">app</span><span class="p">.</span><span class="nx">bonusProductsView</span><span class="p">.</span><span class="nx">loadBonusOption</span><span class="p">();</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-194">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-194">&#182;</a>               </div>               <p>slide down and show the contents of the mini cart</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">slide</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">initialized</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
			<span class="p">}</span>

			<span class="k">if</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">suppressSlideDown</span> <span class="o">&amp;&amp;</span> <span class="nx">app</span><span class="p">.</span><span class="nx">minicart</span><span class="p">.</span><span class="nx">suppressSlideDown</span><span class="p">())</span> <span class="p">{</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="nx">timer</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-195">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-195">&#182;</a>               </div>               <p>show the item</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$cache</span><span class="p">.</span><span class="nx">mcContent</span><span class="p">.</span><span class="nx">slideDown</span><span class="p">(</span><span class="s1">&#39;slow&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-196">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-196">&#182;</a>               </div>               <p>after a time out automatically close it</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">timer</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="mi">6000</span><span class="p">);</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-197">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-197">&#182;</a>               </div>               <p>closes the mini cart with given delay</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">close</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">delay</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">timer</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">mcContent</span><span class="p">.</span><span class="nx">slideUp</span><span class="p">();</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-198">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-198">&#182;</a>               </div>               <p>hook which can be replaced by individual pages/page types (e.g. cart)</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">suppressSlideDown</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-199">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-199">&#182;</a>               </div>               <p>app.dialog</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-200">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-200">&#182;</a>               </div>               <p>private</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">$cache</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-201">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-201">&#182;</a>               </div>               <p>end private</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">create</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-202">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-202">&#182;</a>               </div>               <p>options.target can be an id selector or an jquery object</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="s2">&quot;#dialog-container&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-203">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-203">&#182;</a>               </div>               <p>if no element found, create one</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">target</span><span class="p">.</span><span class="nx">selector</span> <span class="o">&amp;&amp;</span> <span class="nx">target</span><span class="p">.</span><span class="nx">selector</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">id</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">selector</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="nx">target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nx">id</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;dialog-content&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">);</span>
			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-204">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-204">&#182;</a>               </div>               <p>create the dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="o">=</span><span class="nx">target</span><span class="p">;</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="p">{},</span> <span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">settings</span><span class="p">,</span> <span class="nx">params</span><span class="p">.</span><span class="nx">options</span> <span class="o">||</span> <span class="p">{}));</span>
			<span class="k">return</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
		<span class="p">},</span>
		</pre></div>             </td>           </tr>                               <tr id="section-205">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-205">&#182;</a>               </div>               <p>opens a dialog using the given url</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">open</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span> <span class="o">||</span> <span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">length</span><span class="o">===</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
						
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">dialog</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
			<span class="nx">params</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamsToUrl</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span><span class="nx">format</span><span class="o">:</span><span class="s2">&quot;ajax&quot;</span><span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-206">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-206">&#182;</a>               </div>               <p>finally load the dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span><span class="p">.</span><span class="nx">load</span><span class="p">({</span>
				<span class="nx">target</span> <span class="o">:</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">,</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="nx">params</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
				<span class="nx">callback</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					
					<span class="k">if</span><span class="p">(</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s2">&quot;isOpen&quot;</span><span class="p">))</span> <span class="p">{</span>	<span class="k">return</span><span class="p">;</span>	<span class="p">}</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">});</span>
			
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-207">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-207">&#182;</a>               </div>               <p>closes the dialog and triggers the "close" event for the dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">close</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s2">&quot;close&quot;</span><span class="p">);</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-208">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-208">&#182;</a>               </div>               <p>triggers the "apply" event for the dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">triggerApply</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;dialogApplied&quot;</span><span class="p">);</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-209">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-209">&#182;</a>               </div>               <p>attaches the given callback function upon dialog "apply" event</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">onApply</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;dialogApplied&quot;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-210">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-210">&#182;</a>               </div>               <p>triggers the "delete" event for the dialog</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">triggerDelete</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;dialogDeleted&quot;</span><span class="p">);</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-211">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-211">&#182;</a>               </div>               <p>attaches the given callback function upon dialog "delete" event</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">onDelete</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;dialogDeleted&quot;</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-212">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-212">&#182;</a>               </div>               <p>submits the dialog form with the given action</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">submit</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;form:first&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-213">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-213">&#182;</a>               </div>               <p>set the action</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;input/&gt;&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span>
				<span class="nx">name</span> <span class="o">:</span> <span class="nx">action</span><span class="p">,</span>
				<span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;hidden&quot;</span>
			<span class="p">}).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">form</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-214">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-214">&#182;</a>               </div>               <p>serialize the form and get the post url</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">serialize</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-215">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-215">&#182;</a>               </div>               <p>post the data and replace current content with response content</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
				<span class="nx">type</span> <span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
				<span class="nx">data</span> <span class="o">:</span> <span class="nx">post</span><span class="p">,</span>
				<span class="nx">dataType</span> <span class="o">:</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span>
				<span class="nx">success</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">$cache</span><span class="p">.</span><span class="nx">container</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
				<span class="p">},</span>
				<span class="nx">failure</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
					<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">SERVER_ERROR</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">});</span>
		<span class="p">},</span>
		<span class="nx">settings</span> <span class="o">:</span> <span class="p">{</span>
			<span class="nx">autoOpen</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
			<span class="nx">resizable</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
			<span class="nx">bgiframe</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="nx">modal</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="nx">height</span> <span class="o">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
			<span class="nx">width</span> <span class="o">:</span> <span class="s1">&#39;800&#39;</span><span class="p">,</span>
			<span class="nx">buttons</span> <span class="o">:</span> <span class="p">{},</span>
			<span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
			<span class="nx">position</span> <span class="o">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
			<span class="nx">overlay</span> <span class="o">:</span> <span class="p">{</span>
				<span class="nx">opacity</span> <span class="o">:</span> <span class="mf">0.5</span><span class="p">,</span>
				<span class="nx">background</span> <span class="o">:</span> <span class="s2">&quot;black&quot;</span>
			<span class="p">},</span>
			<span class="nx">close</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s2">&quot;destroy&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-216">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-216">&#182;</a>               </div>               <p>app.validator</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

	<span class="kd">var</span> <span class="nx">naPhone</span> <span class="o">=</span> <span class="sr">/^\(?([2-9][0-8][0-9])\)?[\-\. ]?([2-9][0-9]{2})[\-\. ]?([0-9]{4})(\s*x[0-9]+)?$/</span><span class="p">,</span>
		<span class="nx">regex</span> <span class="o">=</span> <span class="p">{</span>
			<span class="nx">phone</span> <span class="o">:</span> <span class="p">{</span>
				<span class="nx">us</span> <span class="o">:</span> <span class="nx">naPhone</span><span class="p">,</span>
				<span class="nx">ca</span> <span class="o">:</span> <span class="nx">naPhone</span>
			<span class="p">},</span>
			<span class="nx">postal</span> <span class="o">:</span> <span class="p">{</span>
				<span class="nx">us</span> <span class="o">:</span> <span class="sr">/^\d{5}(-\d{4})?$/</span><span class="p">,</span>
				<span class="nx">ca</span> <span class="o">:</span> <span class="sr">/^[ABCEGHJKLMNPRSTVXY]{1}\d{1}[A-Z]{1} *\d{1}[A-Z]{1}\d{1}$/</span><span class="p">,</span>
				<span class="nx">gb</span> <span class="o">:</span> <span class="sr">/^GIR?0AA|[A-PR-UWYZ]([0-9]{1,2}|([A-HK-Y][0-9]|[A-HK-Y][0-9]([0-9]|[ABEHMNPRV-Y]))|[0-9][A-HJKS-UW])?[0-9][ABD-HJLNP-UW-Z]{2}$/</span>
			<span class="p">},</span>
			<span class="nx">email</span> <span class="o">:</span> <span class="sr">/^[\w.%+\-]+@[\w.\-]+\.[\w]{2,6}$/</span>
		<span class="p">},</span>
		<span class="nx">settings</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-217">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-217">&#182;</a>               </div>               <p>global form validator settings</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">errorClass</span> <span class="o">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
			<span class="nx">errorElement</span> <span class="o">:</span> <span class="s1">&#39;span&#39;</span><span class="p">,</span>
			<span class="nx">onkeyup</span> <span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
			<span class="nx">onfocusout</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">checkable</span><span class="p">(</span><span class="nx">element</span><span class="p">))</span> <span class="p">{</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">};</span>

	<span class="kd">function</span> <span class="nx">validatePhone</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">country</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;form&quot;</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.country&quot;</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">country</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">country</span><span class="p">.</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="o">!</span><span class="nx">regex</span><span class="p">.</span><span class="nx">phone</span><span class="p">[</span><span class="nx">country</span><span class="p">.</span><span class="nx">val</span><span class="p">().</span><span class="nx">toLowerCase</span><span class="p">()])</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="kd">var</span> <span class="nx">rgx</span> <span class="o">=</span> <span class="nx">regex</span><span class="p">.</span><span class="nx">phone</span><span class="p">[</span><span class="nx">country</span><span class="p">.</span><span class="nx">val</span><span class="p">().</span><span class="nx">toLowerCase</span><span class="p">()];</span>
		<span class="kd">var</span> <span class="nx">isOptional</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">optional</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">isValid</span> <span class="o">=</span> <span class="nx">rgx</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>

		<span class="k">return</span> <span class="nx">isOptional</span> <span class="o">||</span> <span class="nx">isValid</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">function</span> <span class="nx">validateEmail</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">isOptional</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">optional</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">isValid</span> <span class="o">=</span> <span class="nx">regex</span><span class="p">.</span><span class="nx">email</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">value</span><span class="p">));</span>
		<span class="k">return</span> <span class="nx">isOptional</span> <span class="o">||</span> <span class="nx">isValid</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/**</span>
<span class="cm">	 * Add phone validation method to jQuery validation plugin.</span>
<span class="cm">	 * Text fields must have &#39;phone&#39; css class to be validated as phone</span>
<span class="cm">	 */</span>
	<span class="nx">$</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">addMethod</span><span class="p">(</span><span class="s2">&quot;phone&quot;</span><span class="p">,</span> <span class="nx">validatePhone</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">INVALID_PHONE</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Add email validation method to jQuery validation plugin.</span>
<span class="cm">	 * Text fields must have &#39;email&#39; css class to be validated as email</span>
<span class="cm">	 */</span>
	<span class="nx">$</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">addMethod</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="nx">validateEmail</span><span class="p">,</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">INVALID_EMAIL</span><span class="p">);</span>
	
	<span class="cm">/**</span>
<span class="cm">	 * Add gift cert amount validation method to jQuery validation plugin.</span>
<span class="cm">	 * Text fields must have &#39;gift-cert-amont&#39; css class to be validated</span>
<span class="cm">	 */</span>
	<span class="nx">$</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">addMethod</span><span class="p">(</span><span class="s2">&quot;gift-cert-amount&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">el</span><span class="p">){</span>
		<span class="kd">var</span> <span class="nx">isOptional</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">optional</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">isValid</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">5000</span><span class="p">);</span>
		<span class="k">return</span> <span class="nx">isOptional</span> <span class="o">||</span> <span class="nx">isValid</span><span class="p">;</span>
	<span class="p">},</span> <span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">GIFT_CERT_AMOUNT_INVALID</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Add positive number validation method to jQuery validation plugin.</span>
<span class="cm">	 * Text fields must have &#39;positivenumber&#39; css class to be validated as positivenumber</span>
<span class="cm">	 */</span>
	<span class="nx">$</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">addMethod</span><span class="p">(</span><span class="s2">&quot;positivenumber&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">trim</span><span class="p">(</span><span class="nx">value</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> <span class="p">}</span>
		<span class="k">return</span> <span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">},</span> <span class="s2">&quot;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-218">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-218">&#182;</a>               </div>               <p>"" should be replaced with error message if needed</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">messages</span><span class="p">.</span><span class="nx">required</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$1</span><span class="p">,</span> <span class="nx">ele</span><span class="p">,</span> <span class="nx">$3</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">requiredText</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">ele</span><span class="p">).</span><span class="nx">parents</span><span class="p">(</span><span class="s1">&#39;.form-row&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-required-text&#39;</span><span class="p">);</span>
		<span class="k">return</span> <span class="nx">requiredText</span><span class="o">||</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
	<span class="p">};</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">validator</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">regex</span> <span class="o">:</span> <span class="nx">regex</span><span class="p">,</span>
		<span class="nx">settings</span> <span class="o">:</span> <span class="nx">settings</span><span class="p">,</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			
			<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;form:not(.suppress)&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">validate</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">settings</span><span class="p">);</span>
			<span class="p">});</span>
			
		<span class="p">},</span>
		<span class="nx">initForm</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">(</span><span class="nx">f</span><span class="p">).</span><span class="nx">validate</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">validator</span><span class="p">.</span><span class="nx">settings</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-219">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-219">&#182;</a>               </div>               <p>app.ajax</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

	<span class="kd">var</span> <span class="nx">currentRequests</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-220">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-220">&#182;</a>               </div>               <p>request cache</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-221">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-221">&#182;</a>               </div>               <p>sub namespace app.ajax.* contains application specific ajax components</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">app</span><span class="p">.</span><span class="nx">ajax</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-222">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-222">&#182;</a>               </div>               <p>ajax request to get json response
@param - async - boolean - asynchronous or not
@param - url - String - uri for the request
@param - data - name/value pair data request
@param - callback - function - callback function to be called</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">getJson</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">options</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">toAbsoluteUrl</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-223">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-223">&#182;</a>               </div>               <p>return if no url exists or url matches a current request</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span> <span class="o">||</span> <span class="nx">currentRequests</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">])</span> <span class="p">{</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			
			<span class="nx">currentRequests</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-224">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-224">&#182;</a>               </div>               <p>make the server call</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
				<span class="nx">dataType</span> <span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
				<span class="nx">async</span> <span class="o">:</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">async</span><span class="o">===</span><span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">async</span><span class="o">===</span><span class="kc">null</span><span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">async</span><span class="p">,</span>
				<span class="nx">data</span> <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">data</span> <span class="o">||</span> <span class="p">{}</span>
			<span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-225">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-225">&#182;</a>               </div>               <p>success</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-226">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-226">&#182;</a>               </div>               <p>failed</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">textStatus</span> <span class="o">===</span> <span class="s2">&quot;parsererror&quot;</span><span class="p">)</span> <span class="p">{</span>
					<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">BAD_RESPONSE</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-227">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-227">&#182;</a>               </div>               <p>executed on success or fail</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="p">.</span><span class="nx">always</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-228">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-228">&#182;</a>               </div>               <p>remove current request from hash</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="nx">currentRequests</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">])</span> <span class="p">{</span>
					<span class="k">delete</span> <span class="nx">currentRequests</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">];</span>
				<span class="p">}</span>
			<span class="p">});</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-229">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-229">&#182;</a>               </div>               <p>ajax request to load html response in a given container</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-230">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-230">&#182;</a>               </div>               <p>@param - url - String - uri for the request
@param - data - name/value pair data request
@param - callback - function - callback function to be called
@param - target - Object - Selector or element that will receive content</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">load</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">options</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">toAbsoluteUrl</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-231">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-231">&#182;</a>               </div>               <p>return if no url exists or url matches a current request</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span> <span class="o">||</span> <span class="nx">currentRequests</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">])</span> <span class="p">{</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="nx">currentRequests</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-232">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-232">&#182;</a>               </div>               <p>make the server call</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
				<span class="nx">dataType</span> <span class="o">:</span> <span class="s2">&quot;html&quot;</span><span class="p">,</span>
				<span class="nx">url</span> <span class="o">:</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamToURL</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;ajax&quot;</span><span class="p">),</span>
				<span class="nx">data</span> <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">data</span>
			<span class="p">})</span>
			<span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-233">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-233">&#182;</a>               </div>               <p>success</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">empty</span><span class="p">().</span><span class="nx">html</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
				<span class="p">}</span>

			<span class="p">})</span>
			<span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-234">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-234">&#182;</a>               </div>               <p>failed</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="nx">textStatus</span> <span class="o">===</span> <span class="s2">&quot;parsererror&quot;</span><span class="p">)</span> <span class="p">{</span>
					<span class="nb">window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">BAD_RESPONSE</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">);</span>
			<span class="p">})</span>
			<span class="p">.</span><span class="nx">always</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">progress</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-235">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-235">&#182;</a>               </div>               <p>remove current request from hash</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="nx">currentRequests</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">])</span> <span class="p">{</span>
					<span class="k">delete</span> <span class="nx">currentRequests</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">url</span><span class="p">];</span>
				<span class="p">}</span>
			<span class="p">});</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-236">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-236">&#182;</a>               </div>               <p>app.searchsuggest</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">qlen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="nx">listTotal</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
		<span class="nx">listCurrent</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
		<span class="nx">delay</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
		<span class="nx">fieldDefault</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
		<span class="nx">suggestionsJson</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span>
		<span class="nx">$searchForm</span><span class="p">,</span>
		<span class="nx">$searchField</span><span class="p">,</span>
		<span class="nx">$searchContainer</span><span class="p">,</span>
		<span class="nx">$resultsContainer</span><span class="p">;</span>

	<span class="kd">function</span> <span class="nx">handleArrowKeys</span><span class="p">(</span><span class="nx">keyCode</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="nx">keyCode</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="mi">38</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-237">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-237">&#182;</a>               </div>               <p>keyUp</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">listCurrent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">listCurrent</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="nx">listTotal</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="nx">listCurrent</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">40</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-238">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-238">&#182;</a>               </div>               <p>keyDown</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">listCurrent</span> <span class="o">=</span> <span class="p">(</span><span class="nx">listCurrent</span> <span class="o">&gt;=</span> <span class="nx">listTotal</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">listCurrent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">default</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-239">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-239">&#182;</a>               </div>               <p>reset</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">listCurrent</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
				<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="nx">$resultsContainer</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;selected&quot;</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="nx">listCurrent</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;selected&quot;</span><span class="p">);</span>
		<span class="nx">$searchField</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">$resultsContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.selected div.suggestionterm&quot;</span><span class="p">).</span><span class="nx">first</span><span class="p">().</span><span class="nx">text</span><span class="p">());</span>
		<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">app</span><span class="p">.</span><span class="nx">searchsuggest</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-240">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-240">&#182;</a>               </div>               <p>configuration parameters and required object instances</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">container</span><span class="p">,</span> <span class="nx">defaultValue</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-241">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-241">&#182;</a>               </div>               <p>initialize vars</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$searchContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">container</span><span class="p">);</span>
			<span class="nx">$searchForm</span> <span class="o">=</span> <span class="nx">$searchContainer</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;form[name=&#39;simpleSearch&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">$searchField</span> <span class="o">=</span> <span class="nx">$searchForm</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;input[name=&#39;q&#39;]&quot;</span><span class="p">);</span>
			<span class="nx">fieldDefault</span> <span class="o">=</span> <span class="nx">defaultValue</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-242">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-242">&#182;</a>               </div>               <p>disable browser auto complete</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$searchField</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;autocomplete&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-243">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-243">&#182;</a>               </div>               <p>on focus listener (clear default value)</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$searchField</span><span class="p">.</span><span class="nx">focus</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">$resultsContainer</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-244">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-244">&#182;</a>               </div>               <p>create results container if needed</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">$resultsContainer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;div/&gt;&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;suggestions&quot;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$searchContainer</span><span class="p">).</span><span class="nx">css</span><span class="p">({</span>
						<span class="s2">&quot;top&quot;</span> <span class="o">:</span> <span class="nx">$searchContainer</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offsetHeight</span><span class="p">,</span>
						<span class="s2">&quot;left&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
						<span class="s2">&quot;width&quot;</span> <span class="o">:</span> <span class="nx">$searchField</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offsetWidth</span>
					<span class="p">});</span>
				<span class="p">}</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">$searchField</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">===</span> <span class="nx">fieldDefault</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">$searchField</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-245">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-245">&#182;</a>               </div>               <p>on blur listener</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$searchField</span><span class="p">.</span><span class="nx">blur</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
				<span class="nx">setTimeout</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">searchsuggest</span><span class="p">.</span><span class="nx">clearResults</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
			<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-246">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-246">&#182;</a>               </div>               <p>on key up listener</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$searchField</span><span class="p">.</span><span class="nx">keyup</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-247">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-247">&#182;</a>               </div>               <p>get keyCode (window.event is for IE)</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="kd">var</span> <span class="nx">keyCode</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-248">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-248">&#182;</a>               </div>               <p>check and treat up and down arrows</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="nx">handleArrowKeys</span><span class="p">(</span><span class="nx">keyCode</span><span class="p">))</span> <span class="p">{</span>
					<span class="k">return</span><span class="p">;</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-249">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-249">&#182;</a>               </div>               <p>check for an ENTER or ESC</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">13</span> <span class="o">||</span> <span class="nx">keyCode</span> <span class="o">===</span> <span class="mi">27</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">searchsuggest</span><span class="p">.</span><span class="nx">clearResults</span><span class="p">();</span>
					<span class="k">return</span><span class="p">;</span>
				<span class="p">}</span>

				<span class="kd">var</span> <span class="nx">lastVal</span> <span class="o">=</span> <span class="nx">$searchField</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-250">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-250">&#182;</a>               </div>               <p>if is text, call with delay</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="nx">app</span><span class="p">.</span><span class="nx">searchsuggest</span><span class="p">.</span><span class="nx">suggest</span><span class="p">(</span><span class="nx">lastVal</span><span class="p">);</span> <span class="p">},</span> <span class="nx">delay</span><span class="p">);</span>
			<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-251">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-251">&#182;</a>               </div>               <p>on submit we do not submit the form, but change the window location
in order to avoid https to http warnings in the browser
only if it's not the default value and it's not empty</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$searchForm</span><span class="p">.</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
				<span class="kd">var</span> <span class="nx">searchTerm</span> <span class="o">=</span> <span class="nx">$searchField</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">searchTerm</span> <span class="o">===</span> <span class="nx">fieldDefault</span> <span class="o">||</span> <span class="nx">searchTerm</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamToURL</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">),</span> <span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="nx">searchTerm</span><span class="p">);</span>
			<span class="p">});</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-252">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-252">&#182;</a>               </div>               <p>trigger suggest action</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">suggest</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">lastValue</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-253">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-253">&#182;</a>               </div>               <p>get the field value</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">part</span> <span class="o">=</span> <span class="nx">$searchField</span><span class="p">.</span><span class="nx">val</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-254">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-254">&#182;</a>               </div>               <p>if it's empty clear the resuts box and return</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="nx">part</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">app</span><span class="p">.</span><span class="nx">searchsuggest</span><span class="p">.</span><span class="nx">clearResults</span><span class="p">();</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-255">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-255">&#182;</a>               </div>               <p>if part is not equal to the value from the initiated call,
or there were no results in the last call and the query length
is longer than the last query length, return</p>

<h1>TODO: improve this to look at the query value and length</h1>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span><span class="p">((</span><span class="nx">lastValue</span> <span class="o">!==</span> <span class="nx">part</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">listTotal</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">part</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">qlen</span><span class="p">))</span> <span class="p">{</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="nx">qlen</span> <span class="o">=</span> <span class="nx">part</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-256">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-256">&#182;</a>               </div>               <p>build the request url</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="kd">var</span> <span class="nx">reqUrl</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">appendParamToURL</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">urls</span><span class="p">.</span><span class="nx">searchsuggest</span><span class="p">,</span> <span class="s2">&quot;q&quot;</span><span class="p">,</span> <span class="nx">part</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-257">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-257">&#182;</a>               </div>               <p>get remote data as JSON</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="nx">reqUrl</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-258">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-258">&#182;</a>               </div>               <p>get the total of results</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="kd">var</span> <span class="nx">suggestions</span> <span class="o">=</span> <span class="nx">data</span><span class="p">,</span>
					<span class="nx">ansLength</span> <span class="o">=</span> <span class="nx">suggestions</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
					<span class="nx">listTotal</span> <span class="o">=</span> <span class="nx">ansLength</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-259">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-259">&#182;</a>               </div>               <p>if there are results populate the results div</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="nx">ansLength</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">searchsuggest</span><span class="p">.</span><span class="nx">clearResults</span><span class="p">();</span>
					<span class="k">return</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="nx">suggestionsJson</span> <span class="o">=</span> <span class="nx">suggestions</span><span class="p">;</span>
				<span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
				<span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="o">=</span><span class="nx">ansLength</span><span class="p">;</span>
				<span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
					<span class="nx">html</span><span class="o">+=</span><span class="s1">&#39;&lt;div&gt;&lt;div class=&quot;suggestionterm&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">suggestions</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">suggestion</span><span class="o">+</span><span class="s1">&#39;&lt;/div&gt;&lt;span class=&quot;hits&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">suggestions</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">hits</span><span class="o">+</span><span class="s1">&#39;&lt;/span&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-260">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-260">&#182;</a>               </div>               <p>update the results div</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$resultsContainer</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">html</span><span class="p">).</span><span class="nx">show</span><span class="p">().</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;hover&quot;</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
					<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">toggleClass</span> <span class="o">=</span> <span class="s2">&quot;selected&quot;</span><span class="p">;</span>
				<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s2">&quot;div&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-261">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-261">&#182;</a>               </div>               <p>on click copy suggestion to search field, hide the list and submit the search</p>             </td>             <td class="code">               <div class="highlight"><pre>					<span class="nx">$searchField</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;.suggestionterm&quot;</span><span class="p">).</span><span class="nx">text</span><span class="p">());</span>
					<span class="nx">app</span><span class="p">.</span><span class="nx">searchsuggest</span><span class="p">.</span><span class="nx">clearResults</span><span class="p">();</span>
					<span class="nx">$searchForm</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;submit&quot;</span><span class="p">);</span>
				<span class="p">});</span>
			<span class="p">});</span>
		<span class="p">},</span>
		<span class="nx">clearResults</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$resultsContainer</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
			<span class="nx">$resultsContainer</span><span class="p">.</span><span class="nx">empty</span><span class="p">().</span><span class="nx">hide</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-262">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-262">&#182;</a>               </div>               <p>app.searchplaceholder</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
	
	<span class="kd">function</span> <span class="nx">initializeEvents</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#q&#39;</span><span class="p">).</span><span class="nx">focus</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">===</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;placeholder&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">})</span>
		<span class="p">.</span><span class="nx">blur</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span> <span class="o">===</span> <span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;placeholder&quot;</span><span class="p">))</span> <span class="p">{</span>
				<span class="nx">input</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;placeholder&quot;</span><span class="p">));</span>
			<span class="p">}</span>
		<span class="p">})</span>
		<span class="p">.</span><span class="nx">blur</span><span class="p">();</span>
	<span class="p">}</span>
	
	<span class="nx">app</span><span class="p">.</span><span class="nx">searchplaceholder</span> <span class="o">=</span> <span class="p">{</span>
		<span class="nx">init</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
			<span class="nx">initializeEvents</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">app</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-263">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-263">&#182;</a>               </div>               <p>jquery extensions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-264">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-264">&#182;</a>               </div>               <p>params
toggleClass - required
triggerSelector - optional. the selector for the element that triggers the event handler. defaults to the child elements of the list.
eventName - optional. defaults to 'click'</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">toggledList</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span> <span class="p">}</span>

		<span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
		<span class="kd">function</span> <span class="nx">handleToggle</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">classTarget</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">triggerSelector</span> <span class="o">?</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parent</span><span class="p">()</span> <span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
			<span class="nx">classTarget</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">toggleClass</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-265">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-265">&#182;</a>               </div>               <p>execute callback if exists</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">options</span><span class="p">.</span><span class="nx">callback</span><span class="p">();</span> <span class="p">}</span>
		<span class="p">}</span>

		<span class="k">return</span> <span class="nx">list</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">eventName</span> <span class="o">||</span> <span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">triggerSelector</span> <span class="o">||</span> <span class="nx">list</span><span class="p">.</span><span class="nx">children</span><span class="p">(),</span> <span class="nx">handleToggle</span><span class="p">);</span>
	<span class="p">};</span>

	<span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">syncHeight</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="kd">function</span> <span class="nx">sortHeight</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span> <span class="o">-</span> <span class="nx">$</span><span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="nx">height</span><span class="p">();</span>
		<span class="p">}</span>

		<span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">makeArray</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
		<span class="nx">arr</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">sortHeight</span><span class="p">);</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]).</span><span class="nx">height</span><span class="p">());</span>
	<span class="p">};</span>
<span class="p">}(</span><span class="nx">jQuery</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-266">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-266">&#182;</a>               </div>               <p>general extension functions</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="nb">String</span><span class="p">.</span><span class="nx">format</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="kd">var</span> <span class="nx">i</span><span class="p">,</span><span class="nx">len</span><span class="o">=</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>       
			<span class="kd">var</span> <span class="nx">reg</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;\\{&quot;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s2">&quot;\\}&quot;</span><span class="p">,</span> <span class="s2">&quot;gm&quot;</span><span class="p">);</span>             
			<span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">reg</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nx">s</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">})();</span></pre></div>             </td>           </tr>                               <tr id="section-267">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-267">&#182;</a>               </div>               <p>initialize app</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">jQuery</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
	<span class="nx">app</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 